<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­£é£å†³ç­–è€… v2.6.2</title>
  <link rel="icon" type="image/png" href="./imgs/monsoon_rain_clouds_game_icon_purple_circle.jpg">
  <link rel="shortcut icon" type="image/png" href="./imgs/monsoon_rain_clouds_game_icon_purple_circle.jpg">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --flood-color: #006994;
      --drought-color: #8B4513;
      --primary-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-bg: rgba(255, 255, 255, 0.95);
      --accent-color: #FF5722;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --danger-color: #f44336;
      --info-color: #2196F3;
      --hell-color: #8B0000;
      --catastrophe-color: #FF0000;
      --policy-bg: rgba(255, 249, 230, 0.9);
      --policy-border: #ffd700;
      --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--primary-bg);
      min-height: 100vh;
      color: #333;
      line-height: 1.6;
    }

    .game-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 20px;
      min-height: 100vh;
    }

    .main-content {
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 20px;
    }

    .game-header {
      background: var(--secondary-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      text-align: center;
      background-image: url('imgs/beautiful_farm_agriculture_landscape_sunset_game_background.jpg');
      background-size: cover;
      background-position: center;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      position: relative;
    }

    .game-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      border-radius: var(--border-radius);
    }

    .game-header * {
      position: relative;
      z-index: 1;
    }

    .game-title {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
    }

    .game-subtitle {
      font-size: 1.2em;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .difficulty-badge {
      display: inline-block;
      padding: 5px 15px;
      background: var(--hell-color);
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      animation: hellPulse 2s infinite;
    }

    @keyframes hellPulse {
      0%, 100% { box-shadow: 0 0 5px var(--hell-color); }
      50% { box-shadow: 0 0 20px var(--catastrophe-color); }
    }

    /* å…³é”®ä¿®å¤ï¼šæ·»åŠ æ¸¸æˆå¤±è´¥ç•Œé¢æ ·å¼ */
    .critical-warning {
      background: rgba(255, 0, 0, 0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: bold;
      text-align: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    .game-over-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .game-over-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      max-width: 500px;
    }

    .game-over-title {
      font-size: 3em;
      color: #ff0000;
      margin-bottom: 20px;
    }

    .game-over-stats {
      margin: 20px 0;
      text-align: left;
    }

    .status-bar {
      background: var(--secondary-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }

    .status-item {
      text-align: center;
      padding: 8px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      border-left: 4px solid var(--accent-color);
      transition: var(--transition);
    }

    .status-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .status-value {
      font-size: 1.2em;
      font-weight: bold;
      color: var(--accent-color);
    }

    .status-label {
      font-size: 0.8em;
      color: #666;
      margin-top: 2px;
    }

    .game-board {
      background: var(--secondary-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .map-container {
      background: linear-gradient(45deg, #8FBC8F, #98FB98);
      border-radius: var(--border-radius);
      height: 250px;
      position: relative;
      overflow: hidden;
      background-image: url('imgs/farm_agriculture_game_background_sunrise_tractor_barn.jpg');
      background-size: cover;
      background-position: center;
    }

    .map-overlay {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: bold;
      z-index: 10;
    }

    .satellite-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      transition: all 0.5s ease;
    }

    .flood-effect {
      background: radial-gradient(circle, transparent 30%, rgba(0, 105, 148, 0.3) 70%);
      animation: flood-wave 2s infinite;
    }

    .drought-effect {
      background: radial-gradient(circle, transparent 30%, rgba(139, 69, 19, 0.3) 70%);
      animation: heat-shimmer 3s infinite;
    }

    .hell-disaster-effect {
      background: radial-gradient(circle, transparent 20%, rgba(255, 0, 0, 0.6) 80%);
      animation: catastrophe-pulse 1s infinite;
    }

    @keyframes flood-wave {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes heat-shimmer {
      0%, 100% { filter: hue-rotate(0deg); }
      50% { filter: hue-rotate(30deg); }
    }

    @keyframes catastrophe-pulse {
      0%, 100% { 
        background: radial-gradient(circle, transparent 20%, rgba(255, 0, 0, 0.6) 80%);
        transform: scale(1);
      }
      50% { 
        background: radial-gradient(circle, transparent 10%, rgba(139, 0, 0, 0.8) 90%);
        transform: scale(1.1);
      }
    }

    .particles {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 5;
    }

    @keyframes particleFloat {
      0% {
        transform: translateY(100px) translateX(0);
        opacity: 1;
      }
      100% {
        transform: translateY(-20px) translateX(20px);
        opacity: 0;
      }
    }

    .game-controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .control-section {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .section-title {
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .crop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 8px;
    }

    .crop-button {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      font-size: 0.9em;
    }

    .crop-button:hover {
      border-color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .crop-button.selected {
      border-color: var(--success-color);
      background: var(--success-color);
      color: white;
    }

    .crop-icon {
      font-size: 1.5em;
      display: block;
      margin-bottom: 4px;
    }

    .crop-description {
      font-size: 0.7em;
      color: #666;
      line-height: 1.2;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel {
      background: var(--secondary-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
    }

    .panel-header {
      background: var(--accent-color);
      color: white;
      padding: 12px 15px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .panel-content {
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
    }

    .policy-card {
      background: var(--policy-bg);
      border: 2px solid var(--policy-border);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: var(--transition);
    }

    .policy-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .policy-card.selected {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      border-color: #ff8c00;
    }

    .policy-title {
      font-weight: bold;
      color: #8B4513;
      margin-bottom: 5px;
    }

    .policy-effect {
      font-size: 0.85em;
      color: #666;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: var(--transition);
      font-size: 0.9em;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .success-btn {
      background: var(--success-color);
      color: white;
    }

    .warning-btn {
      background: var(--warning-color);
      color: white;
    }

    .danger-btn {
      background: var(--danger-color);
      color: white;
    }

    .info-btn {
      background: var(--info-color);
      color: white;
    }

    .hell-btn {
      background: var(--hell-color);
      color: white;
      animation: hellGlow 2s infinite;
    }

    @keyframes hellGlow {
      0%, 100% { box-shadow: 0 0 5px var(--hell-color); }
      50% { box-shadow: 0 0 15px var(--catastrophe-color); }
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 20px;
      border-radius: var(--border-radius);
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    .close {
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: #999;
    }

    .close:hover {
      color: #000;
    }

    .log-container {
      background: #f5f5f5;
      border-radius: 6px;
      padding: 10px;
      max-height: 150px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.8em;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 3px 6px;
      border-radius: 3px;
    }

    .log-success {
      background: #e8f5e8;
      color: #2e7d32;
    }

    .log-warning {
      background: #fff3e0;
      color: #f57c00;
    }

    .log-error {
      background: #ffebee;
      color: #c62828;
    }

    .log-info {
      background: #e3f2fd;
      color: #1976d2;
    }

    .skill-bar {
      background: #e0e0e0;
      border-radius: 10px;
      height: 8px;
      margin-top: 3px;
      overflow: hidden;
    }

    .skill-progress {
      background: linear-gradient(90deg, var(--success-color), var(--warning-color));
      height: 100%;
      transition: width 0.5s ease;
    }

    .reputation-bar {
      background: #e0e0e0;
      border-radius: 10px;
      height: 12px;
      margin: 8px 0;
      overflow: hidden;
      position: relative;
    }

    .reputation-indicator {
      background: linear-gradient(90deg, #4CAF50, #2196F3, #9C27B0, #FF9800, #F44336);
      height: 100%;
      transition: width 0.5s ease;
      border-radius: 10px;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8em;
    }

    .history-table th,
    .history-table td {
      padding: 4px 6px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    .history-table th {
      background: #f5f5f5;
      font-weight: bold;
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .popup-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .bulletin-board {
      background: linear-gradient(135deg, #FFE4B5, #DDD);
      border: 3px solid #8B4513;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .bulletin-title {
      font-size: 1.1em;
      font-weight: bold;
      color: #8B4513;
      margin-bottom: 10px;
      text-align: center;
      border-bottom: 2px solid #8B4513;
      padding-bottom: 5px;
    }

    .bulletin-content {
      font-size: 0.9em;
      line-height: 1.4;
      color: #333;
    }

    .hell-indicator {
      background: linear-gradient(45deg, var(--hell-color), var(--catastrophe-color));
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: bold;
      animation: hellPulse 2s infinite;
    }

    .anti-afk-warning {
      background: linear-gradient(45deg, #FF4444, #AA0000);
      color: white;
      padding: 8px 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      margin: 10px 0;
      animation: warningFlash 1s infinite;
    }

    @keyframes warningFlash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .survival-equipment {
      background: linear-gradient(135deg, #2C5364, #203A43, #0F2027);
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin: 5px 0;
      border-left: 4px solid var(--catastrophe-color);
    }

    .export-preview {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 800px;
      margin: 20px auto;
    }

    .achievement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 5px;
      margin-top: 10px;
    }

    .achievement-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .achievement-icon:hover {
      transform: scale(1.1);
    }

    .achievement-unlocked {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .achievement-locked {
      background: #CCC;
      color: #666;
    }

    .radar-chart-container {
      width: 300px;
      height: 300px;
      margin: 20px auto;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1200px) {
      .game-container {
        grid-template-columns: 1fr;
        max-width: 100%;
      }
      
      .sidebar {
        grid-row: 2;
      }
    }

    @media (max-width: 768px) {
      .game-container {
        padding: 10px;
      }
      
      .game-board {
        grid-template-columns: 1fr;
      }
      
      .status-bar {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>
  <!-- æ•™ç¨‹è¦†ç›–å±‚ -->
  <div id="tutorial-overlay" class="popup-overlay" style="display: none;">
    <div class="popup-content">
      <h2>ğŸŒ¾ æ¬¢è¿æ¥åˆ°å­£é£å†³ç­–è€… v2.6.2ï¼</h2>
      <p id="tutorial-text">åœ¨è¿™ä¸ªæè‡´æŒ‘æˆ˜çš„å†œä¸šç»è¥æ¸¸æˆä¸­ï¼Œæ‚¨å°†é¢å¯¹å‰æ‰€æœªæœ‰çš„å›°éš¾...</p>
      <div style="margin-top: 20px;">
        <button onclick="nextTutorial()" class="btn info-btn">ä¸‹ä¸€æ­¥</button>
        <button onclick="skipTutorial()" class="btn warning-btn">è·³è¿‡æ•™ç¨‹</button>
      </div>
    </div>
  </div>

  <!-- å‡ºç”Ÿåœ°é€‰æ‹©è¦†ç›–å±‚ -->
  <div id="birthplace-overlay" class="popup-overlay">
    <div class="popup-content">
      <h2>ğŸŒ é€‰æ‹©æ‚¨çš„å‡ºç”Ÿåœ°</h2>
      <p>ä¸åŒçš„å‡ºç”Ÿåœ°å°†å¸¦æ¥ä¸åŒçš„åˆå§‹æ¡ä»¶å’Œç‰¹æ®Šä¼˜åŠ¿</p>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0;">
        <button onclick="selectBirthplace('china-south')" class="btn info-btn">ğŸ‡¨ğŸ‡³ ä¸­å›½å—æ–¹<br><small>æ°´ç¨»ä¼˜åŠ¿</small></button>
        <button onclick="selectBirthplace('china-north')" class="btn info-btn">ğŸ‡¨ğŸ‡³ ä¸­å›½åŒ—æ–¹<br><small>å°éº¦ä¼˜åŠ¿</small></button>
        <button onclick="selectBirthplace('india-east')" class="btn info-btn">ğŸ‡®ğŸ‡³ å°åº¦ä¸œéƒ¨<br><small>å­£é£å‰æ²¿</small></button>
        <button onclick="selectBirthplace('sea-thailand')" class="btn info-btn">ğŸ‡¹ğŸ‡­ æ³°å›½<br><small>çƒ­å¸¦ä½œç‰©</small></button>
        <button onclick="selectBirthplace('africa-east')" class="btn info-btn">ğŸŒ ä¸œé<br><small>å’–å•¡ä¼˜åŠ¿</small></button>
        <button onclick="selectBirthplace('russia-south')" class="btn info-btn">ğŸ‡·ğŸ‡º ä¿„å›½å—éƒ¨<br><small>æœºæ¢°åŒ–</small></button>
      </div>
    </div>
  </div>

  <!-- éš¾åº¦é€‰æ‹©è¦†ç›–å±‚ -->
  <div id="difficulty-overlay" class="popup-overlay" style="display: none;">
    <div class="popup-content">
      <h2>âš¡ é€‰æ‹©æ¸¸æˆéš¾åº¦</h2>
      <p>v2.6.2 æä¾›å²æ— å‰ä¾‹çš„æŒ‘æˆ˜ç­‰çº§ï¼</p>
      <div style="margin: 20px 0;">
        <button onclick="selectDifficulty(10)" class="btn success-btn">ğŸŸ¢ 10% - æ–°æ‰‹æ¨¡å¼<br><small>åŸç‰ˆä½“éªŒï¼Œé€‚åˆå­¦ä¹ </small></button>
        <button onclick="selectDifficulty(30)" class="btn warning-btn">ğŸŸ¡ 30% - æ ‡å‡†æŒ‘æˆ˜<br><small>2å€éš¾åº¦å€æ•°</small></button>
        <button onclick="selectDifficulty(50)" class="btn info-btn">ğŸŸ  50% - å›°éš¾æ¨¡å¼<br><small>5å€éš¾åº¦å€æ•°</small></button>
        <button onclick="selectDifficulty(70)" class="btn danger-btn">ğŸ”´ 70% - åœ°ç‹±æ¨¡å¼<br><small>10å€éš¾åº¦ + ç­ä¸–ç¾å®³</small></button>
        <button onclick="selectDifficulty(90)" class="btn hell-btn">âš« 90% - ç»æœ›æ¨¡å¼<br><small>20å€éš¾åº¦ + ç»ˆææŒ‘æˆ˜</small></button>
        <button onclick="selectGameMode('endless')" class="btn hell-btn">â™¾ï¸ æ— å°½æ¨¡å¼<br><small>æ¯5å¹´é€’å¢éš¾åº¦ç›´è‡³ç»ˆç»“</small></button>
      </div>
    </div>
  </div>

  <!-- ä¸»æ¸¸æˆç•Œé¢ -->
  <div class="game-container">
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
      <!-- æ¸¸æˆæ ‡é¢˜ -->
      <div class="game-header">
        <h1 class="game-title">å­£é£å†³ç­–è€…</h1>
        <div class="game-subtitle">v2.6 åœ°ç‹±ç‰ˆ - ç»ˆæéš¾åº¦å®Œæ•´ç‰ˆ</div>
        <div class="difficulty-badge" id="difficulty-display">æé™åœ°ç‹±æ¨¡å¼æ¿€æ´»</div>
        
        <!-- å¼€å‘è€…å…¬å‘Šæ  -->
        <div class="bulletin-board" style="margin-top: 15px;">
          <div class="bulletin-title">ğŸ“¢ v2.6 ç‰ˆæœ¬æ›´æ–°</div>
          <div class="bulletin-content">
            ğŸ”¥ ä¿®å¤ç‰ˆç»ˆæéš¾åº¦ï¼å½»åº•è§£å†³æ— é™ç”Ÿå­˜æ¼æ´ï¼<br>
            âš¡ ä¿ç•™æ‰€æœ‰å®Œæ•´åŠŸèƒ½ï¼šè®¾å¤‡ã€ç ”å‘ã€æˆå°±ã€æ”¿ç­–ã€å¸‚åœºç³»ç»Ÿï¼<br>
            ğŸ’€ æ–°å¢å¤šé‡å¤±è´¥æœºåˆ¶ï¼šäººå£å½’é›¶ã€èµ„é‡‘è€—å°½ã€ç”Ÿå­˜å‹åŠ›è¿‡è½½ï¼<br>
            â˜¢ï¸ è­¦å‘Šï¼šæ­¤ç‰ˆæœ¬å¯èƒ½å¯¼è‡´ä¸¥é‡ç²¾ç¥åˆ›ä¼¤ï¼ä¸é€‚åˆå¿ƒè„ä¸å¥½çš„ç©å®¶ï¼
          </div>
        </div>

        <!-- å…³é”®ä¿®å¤ï¼šæ·»åŠ ä¸´ç•Œè­¦å‘Š -->
        <div class="critical-warning" id="critical-warning" style="display: none;">
          âš ï¸ ä¸´ç•ŒçŠ¶æ€ï¼å†æ¬¡å¤±è´¥å¯èƒ½å¯¼è‡´æ¸¸æˆç»“æŸï¼
        </div>
      </div>

      <!-- çŠ¶æ€æ  -->
      <div class="status-bar">
        <div class="status-item">
          <div class="status-value" id="money-display">300</div>
          <div class="status-label">èµ„é‡‘ (â‚¹)</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="year-display">1</div>
          <div class="status-label">å¹´ä»½</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="population-display">80</div>
          <div class="status-label">äººå£</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="weather-display">æ­£å¸¸</div>
          <div class="status-label">å¤©æ°”</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="season-display">æ˜¥å­£</div>
          <div class="status-label">å­£èŠ‚</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="current-crop-display">æœªé€‰æ‹©</div>
          <div class="status-label">å½“å‰ä½œç‰©</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="farmer-level-display">1</div>
          <div class="status-label">å†œæ°‘ç­‰çº§</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="reputation-display">0</div>
          <div class="status-label">å£°æœ›å€¼</div>
        </div>
        <!-- å…³é”®ä¿®å¤ï¼šæ·»åŠ ç”Ÿå­˜å‹åŠ›å’Œå¤±è´¥è­¦å‘Šæ˜¾ç¤º -->
        <div class="status-item">
          <div class="status-value" id="survival-pressure-display">0%</div>
          <div class="status-label">âš¡ ç”Ÿå­˜å‹åŠ›</div>
        </div>
        <div class="status-item">
          <div class="status-value" id="failure-warnings-display">0/3</div>
          <div class="status-label">ğŸ’€ å¤±è´¥è­¦å‘Š</div>
        </div>
      </div>

      <!-- æ¸¸æˆé¢æ¿ -->
      <div class="game-board">
        <!-- åœ°å›¾åŒºåŸŸ -->
        <div class="map-container">
          <div class="map-overlay" id="map-info">
            åœ°å›¾ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º
          </div>
          <div class="satellite-overlay" id="weather-overlay"></div>
          <div class="particles" id="weather-particles"></div>
        </div>

        <!-- æ¸¸æˆæ§åˆ¶ -->
        <div class="game-controls">
          <!-- éš¾åº¦æŒ‡ç¤ºå™¨ -->
          <div class="control-section">
            <div class="section-title">âš¡ éš¾åº¦çŠ¶æ€</div>
            <div id="difficulty-indicator" class="hell-indicator">
              åœ°ç‹±æ¨¡å¼æ¿€æ´» - æé™æŒ‘æˆ˜
            </div>
            <div id="afk-warning" class="anti-afk-warning" style="display: none;">
              âš ï¸ åæŒ‚æœºè­¦å‘Šï¼šè¯·é‡‡å–è¡ŒåŠ¨æˆ–å°†é¢ä¸´æƒ©ç½šï¼
            </div>
          </div>

          <!-- ä½œç‰©é€‰æ‹© -->
          <div class="control-section">
            <div class="section-title">
              ğŸŒ¾ ä½œç‰©é€‰æ‹©
              <span style="font-size: 0.8em; color: #666;">å½“å‰å­£èŠ‚: <span id="season-indicator">æ˜¥å­£</span></span>
            </div>
            <div class="crop-grid">
              <!-- åŸºç¡€ç²®é£Ÿä½œç‰© -->
              <button class="crop-button" onclick="chooseCrop('æ°´ç¨»')" data-crop="æ°´ç¨»">
                <span class="crop-icon">ğŸŒ¾</span>
                <div>æ°´ç¨»</div>
                <div class="crop-description">ä¸»é£Ÿä½œç‰©<br>æ´ªæ°´é€‚åº”</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('å°éº¦')" data-crop="å°éº¦">
                <span class="crop-icon">ğŸŒ¾</span>
                <div>å°éº¦</div>
                <div class="crop-description">è€å¯’ä½œç‰©<br>ç¨³å®šäº§é‡</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('ç‰ç±³')" data-crop="ç‰ç±³">
                <span class="crop-icon">ğŸŒ½</span>
                <div>ç‰ç±³</div>
                <div class="crop-description">é«˜äº§ä½œç‰©<br>é¥²æ–™ç”¨é€”</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('å¤§è±†')" data-crop="å¤§è±†">
                <span class="crop-icon">ğŸ«˜</span>
                <div>å¤§è±†</div>
                <div class="crop-description">è›‹ç™½è´¨ä½œç‰©<br>åœŸå£¤æ”¹è‰¯</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('é«˜ç²±')" data-crop="é«˜ç²±">
                <span class="crop-icon">ğŸŒ¾</span>
                <div>é«˜ç²±</div>
                <div class="crop-description">æŠ—æ—±<br>å¹²æ—±é€‚åº”</div>
              </button>
              <!-- ç»æµä½œç‰© -->
              <button class="crop-button" onclick="chooseCrop('æ£‰èŠ±')" data-crop="æ£‰èŠ±">
                <span class="crop-icon">ğŸŒ¿</span>
                <div>æ£‰èŠ±</div>
                <div class="crop-description">ç»æµä½œç‰©<br>é«˜ä»·å€¼</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('èŒ¶å¶')" data-crop="èŒ¶å¶">
                <span class="crop-icon">ğŸƒ</span>
                <div>èŒ¶å¶</div>
                <div class="crop-description">å±±åœ°ä½œç‰©<br>ç‰¹æ®Šç¯å¢ƒ</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('ç”˜è”—')" data-crop="ç”˜è”—">
                <span class="crop-icon">ğŸ‹</span>
                <div>ç”˜è”—</div>
                <div class="crop-description">çƒ­å¸¦ä½œç‰©<br>é«˜æ¸©å¤šæ¹¿</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('æ©¡èƒ¶')" data-crop="æ©¡èƒ¶">
                <span class="crop-icon">ğŸŒ³</span>
                <div>æ©¡èƒ¶</div>
                <div class="crop-description">çƒ­å¸¦ç»æµ<br>é•¿æœŸæŠ•èµ„</div>
              </button>
              <!-- æ–°å¢ç‰¹æ®Šä½œç‰© -->
              <button class="crop-button" onclick="chooseCrop('å’–å•¡')" data-crop="å’–å•¡">
                <span class="crop-icon">â˜•</span>
                <div>å’–å•¡</div>
                <div class="crop-description">é«˜ä»·ç»æµ<br>å±±åœ°ç§æ¤</div>
              </button>
              <button class="crop-button" onclick="chooseCrop('å¯å¯')" data-crop="å¯å¯">
                <span class="crop-icon">ğŸ«</span>
                <div>å¯å¯</div>
                <div class="crop-description">çƒ­å¸¦çå“<br>é•¿æœŸæ”¶ç›Š</div>
              </button>
            </div>
          </div>

          <!-- æ“ä½œæŒ‰é’® -->
          <div class="control-section">
            <div class="section-title">ğŸ® æ¸¸æˆæ“ä½œ</div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
              <button onclick="nextTurn()" id="next-turn-btn" class="btn success-btn">ä¸‹ä¸€å›åˆ â­ï¸</button>
              <button onclick="showMarket()" class="btn warning-btn">å¸‚åœºäº¤æ˜“ ğŸª</button>
              <button onclick="showLoanCenter()" class="btn danger-btn">è´·æ¬¾ä¸­å¿ƒ ğŸ¦</button>
              <button onclick="showInsurance()" class="btn info-btn">å†œä¸šä¿é™© ğŸ›¡ï¸</button>
              <button onclick="showCoop()" class="btn success-btn">åˆä½œç¤¾ ğŸ¤</button>
              <button onclick="showResearch()" class="btn info-btn">ç ”å‘ä¸­å¿ƒ ğŸ”¬</button>
            </div>
          </div>

          <!-- æŠ€èƒ½ä¸ç»éªŒ -->
          <div class="control-section">
            <div class="section-title">ğŸ“ˆ å†œæ°‘æŠ€èƒ½</div>
            <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
              <div style="margin-bottom: 8px;">
                ç§æ¤ç»éªŒ: <span id="planting-exp">0</span>/<span id="planting-exp-needed">100</span>
                <div class="skill-bar">
                  <div class="skill-progress" id="planting-progress" style="width: 0%"></div>
                </div>
              </div>
              <div style="margin-bottom: 8px;">
                ç®¡ç†ç»éªŒ: <span id="management-exp">0</span>/<span id="management-exp-needed">100</span>
                <div class="skill-bar">
                  <div class="skill-progress" id="management-progress" style="width: 0%"></div>
                </div>
              </div>
              <div style="margin-bottom: 8px;">
                å¸‚åœºç»éªŒ: <span id="market-exp">0</span>/<span id="market-exp-needed">100</span>
                <div class="skill-bar">
                  <div class="skill-progress" id="market-progress" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- å£°æœ›ç³»ç»Ÿ -->
          <div class="control-section">
            <div class="section-title">ğŸŒŸ å£°æœ›ç³»ç»Ÿ</div>
            <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
              <div>å£°æœ›ç­‰çº§: <span id="reputation-level">æ–°æ‰‹å†œæ°‘</span></div>
              <div class="reputation-bar">
                <div class="reputation-indicator" id="reputation-indicator"></div>
              </div>
              <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                <span id="reputation-desc">åˆšåˆšå¼€å§‹å†œä¸šç”Ÿæ¶¯</span>
              </div>
            </div>
          </div>

          <!-- ç¯å¢ƒç³»ç»Ÿ -->
          <div class="control-section">
            <div class="section-title">ğŸŒ ç¯å¢ƒç³»ç»Ÿ</div>
            <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
              <div style="margin-bottom: 8px;">
                ç¯å¢ƒå¥åº·: <span id="environmental-health">100</span>/100
                <div class="skill-bar">
                  <div class="skill-progress" id="environmental-progress" style="width: 100%"></div>
                </div>
              </div>
              <div style="margin-bottom: 8px;">
                å¯æŒç»­æ€§: <span id="sustainability-score">0</span>åˆ†
              </div>
              <div style="margin-bottom: 8px;">
                ç¢³è¶³è¿¹: <span id="carbon-footprint">0</span>kg COâ‚‚
              </div>
            </div>
          </div>

          <!-- å¸‚åœºåˆ†æ -->
          <div class="control-section">
            <div class="section-title">ğŸ“ˆ å¸‚åœºåˆ†æ</div>
            <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
              <div id="market-analysis">
                <div>å¸‚åœºè¶‹åŠ¿åˆ†æå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
              </div>
              <button onclick="showDetailedMarketAnalysis()" class="btn info-btn" style="width: 100%; margin-top: 8px;">
                è¯¦ç»†å¸‚åœºåˆ†æ
              </button>
            </div>
          </div>

          <!-- æ”¿ç­–ä¸­å¿ƒ -->
          <div class="control-section">
            <div class="section-title">ğŸ›ï¸ æ”¿ç­–ä¸­å¿ƒ</div>
            <div style="background: rgba(255,255,255,0.8); padding: 12px; border-radius: 8px;">
              <div id="current-policies">
                <div style="font-size: 0.9em; color: #666;">å½“å‰æ— æ´»è·ƒæ”¿ç­–</div>
              </div>
              <button onclick="showPolicyCenter()" class="btn warning-btn" style="width: 100%; margin-top: 8px;">
                æ”¿ç­–ç®¡ç†
              </button>
            </div>
          </div>

          <!-- ç”Ÿå­˜è®¾å¤‡ï¼ˆåœ°ç‹±ç‰ˆç‰¹è‰²ï¼‰ -->
          <div class="control-section">
            <div class="section-title">ğŸ›¡ï¸ ç”Ÿå­˜è®¾å¤‡</div>
            <div id="survival-equipment-panel">
              <p style="color: #666; text-align: center; font-size: 0.9em;">
                é«˜éš¾åº¦æ¨¡å¼ä¸‹çš„ç”Ÿå­˜è£…å¤‡å°†åœ¨è¿™é‡Œæ˜¾ç¤º
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å³ä¾§è¾¹æ  -->
    <div class="sidebar">
      <!-- å®æ—¶ä¿¡æ¯é¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ“Š å®æ—¶ä¿¡æ¯
        </div>
        <div class="panel-content">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85em;">
            <div>æ¸¸æˆæ—¶é•¿: <span id="game-duration">0</span>åˆ†é’Ÿ</div>
            <div>æ“ä½œæ¬¡æ•°: <span id="action-count">0</span></div>
            <div>å¹³å‡APM: <span id="apm">0</span></div>
            <div>æ•ˆç‡è¯„åˆ†: <span id="efficiency-score">0</span></div>
          </div>
        </div>
      </div>

      <!-- å¸‚åœºé¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸª å†œäº§å“å¸‚åœº
        </div>
        <div class="panel-content" id="market-panel">
          <!-- å¸‚åœºå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- äº‹ä»¶é€šçŸ¥é¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ“¢ äº‹ä»¶é€šçŸ¥
        </div>
        <div class="panel-content" id="events-panel">
          <div style="color: #666; text-align: center; font-size: 0.9em;">æš‚æ— æ´»è·ƒäº‹ä»¶</div>
        </div>
      </div>

      <!-- è®¾å¤‡é¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ”§ å†œä¸šè®¾å¤‡
        </div>
        <div class="panel-content" id="equipment-panel">
          <!-- è®¾å¤‡å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- æˆå°±é¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ† æˆå°±ä¸å¥–åŠ±
        </div>
        <div class="panel-content" id="achievement-panel">
          <p style="color: #666; text-align: center;">æš‚æ— æˆå°±</p>
        </div>
      </div>

      <!-- ç»Ÿè®¡é¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ“ˆ æ¸¸æˆç»Ÿè®¡
        </div>
        <div class="panel-content">
          <div style="font-size: 0.8em;">
            <div style="margin-bottom: 5px;">
              <strong>åŸºç¡€ç»Ÿè®¡</strong>
            </div>
            <div>è®¾å¤‡è´­ä¹°: <span id="total-equipment">0</span>ä»¶</div>
            <div>ç ”å‘å®Œæˆ: <span id="total-research">0</span>é¡¹</div>
            <div>æ”¿ç­–åº”ç”¨: <span id="total-policies">0</span>æ¬¡</div>
            <div>äº‹ä»¶ç»å†: <span id="total-events">0</span>æ¬¡</div>
            <div style="margin: 8px 0; border-top: 1px solid #eee; padding-top: 5px;">
              <strong>å·…å³°è®°å½•</strong>
            </div>
            <div>æœ€é«˜äººå£: <span id="max-population">80</span>äºº</div>
            <div>æœ€é•¿è¿èƒœ: <span id="longest-streak">0</span>å¹´</div>
            <div>ç¯å¢ƒè¯„åˆ†: <span id="env-score">100</span>/100</div>
          </div>
        </div>
      </div>

      <!-- å†å²è®°å½• -->
      <div class="panel">
        <div class="panel-header">
          ğŸ“Š ç»è¥å†å²
        </div>
        <div class="panel-content">
          <table class="history-table">
            <thead>
              <tr>
                <th>å¹´ä»½</th>
                <th>å¤©æ°”</th>
                <th>æ”¶å…¥</th>
                <th>ä½œç‰©</th>
              </tr>
            </thead>
            <tbody id="history-body">
              <!-- å†å²è®°å½•å°†åŠ¨æ€ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- æ—¥å¿—é¢æ¿ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ“œ æ¸¸æˆæ—¥å¿—
        </div>
        <div class="panel-content">
          <div class="log-container" id="log-container">
            <!-- æ—¥å¿—å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>

      <!-- å¯¼å‡ºåŠŸèƒ½ -->
      <div class="panel">
        <div class="panel-header">
          ğŸ“¤ æ•°æ®å¯¼å‡º
        </div>
        <div class="panel-content">
          <button onclick="showExportModal()" class="btn info-btn" style="width: 100%; margin-bottom: 10px;">
            ğŸ“Š å¯¼å‡ºæˆ˜ç»©å›¾ç‰‡
          </button>
          <button onclick="exportGameData()" class="btn warning-btn" style="width: 100%; margin-bottom: 10px;">
            ğŸ’¾ å¯¼å‡ºJSONæ•°æ®
          </button>
          <button onclick="exportDetailedReport()" class="btn success-btn" style="width: 100%; margin-bottom: 10px;">
            ğŸ“‹ å¯¼å‡ºè¯¦ç»†æŠ¥å‘Š
          </button>
          <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
            <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="restoreGameData(event)">
            <button onclick="document.getElementById('restore-file').click()" class="btn danger-btn" style="width: 100%;">
              ğŸ“ æ¢å¤å­˜æ¡£
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- å…³é”®ä¿®å¤ï¼šæ·»åŠ æ¸¸æˆå¤±è´¥ç•Œé¢ -->
  <div class="game-over-screen" id="game-over-screen">
    <div class="game-over-content">
      <div class="game-over-title">ğŸ’€ æ¸¸æˆç»“æŸ</div>
      <div class="game-over-stats" id="game-over-stats"></div>
      <button onclick="restartGame()" class="btn success-btn">é‡æ–°å¼€å§‹</button>
    </div>
  </div>

  <!-- æ”¿ç­–ä¸­å¿ƒæ¨¡æ€æ¡† -->
  <div id="policy-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closePolicyModal()">&times;</span>
      <h2>ğŸ›ï¸ æ”¿ç­–ç®¡ç†ä¸­å¿ƒ</h2>
      
      <div style="margin: 20px 0;">
        <h3>å½“å‰æ´»è·ƒæ”¿ç­–</h3>
        <div id="active-policies-list">
          <p style="color: #666;">å½“å‰æ— æ´»è·ƒæ”¿ç­–</p>
        </div>
      </div>
      
      <div style="margin: 20px 0;">
        <h3>å¯ç”³è¯·æ”¿ç­–</h3>
        <div id="available-policies-list">
          <!-- æ”¿ç­–åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="closePolicyModal()" class="btn info-btn">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- å¸‚åœºåˆ†ææ¨¡æ€æ¡† -->
  <div id="market-analysis-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeMarketAnalysisModal()">&times;</span>
      <h2>ğŸ“ˆ è¯¦ç»†å¸‚åœºåˆ†æ</h2>
      
      <div style="margin: 20px 0;">
        <div id="detailed-market-content">
          <!-- è¯¦ç»†å¸‚åœºåˆ†æå†…å®¹ -->
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="closeMarketAnalysisModal()" class="btn info-btn">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- å¯¼å‡ºæ¨¡æ€æ¡† -->
  <div id="export-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeExportModal()">&times;</span>
      <h2>ğŸ“Š æˆ˜ç»©å¯¼å‡º</h2>
      
      <div style="margin: 20px 0;">
        <label>ç©å®¶å§“åï¼š</label>
        <input type="text" id="player-name" placeholder="è¾“å…¥æ‚¨çš„åå­—" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc; width: 200px;">
      </div>
      
      <!-- å¯¼å‡ºé¢„è§ˆåŒºåŸŸ -->
      <div id="export-preview" class="export-preview">
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px 10px 0 0;">
          <h1>ğŸŒ¾ å­£é£å†³ç­–è€… v2.6.2</h1>
          <h2 id="preview-player-name">ç©å®¶æˆ˜ç»©æŠ¥å‘Š</h2>
          <div id="preview-date"></div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px;">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div>
            <h3>ğŸ® æ¸¸æˆä¿¡æ¯</h3>
            <div id="preview-game-info"></div>
          </div>
          
          <!-- æˆå°±å¢™ -->
          <div>
            <h3>ğŸ† æˆå°±å¢™</h3>
            <div id="preview-achievements" class="achievement-grid"></div>
          </div>
        </div>
        
        <!-- é›·è¾¾å›¾ -->
        <div style="text-align: center; padding: 20px;">
          <h3>ğŸ“Š èƒ½åŠ›é›·è¾¾å›¾</h3>
          <div class="radar-chart-container">
            <canvas id="radar-chart"></canvas>
          </div>
        </div>
        
        <!-- ç»Ÿè®¡æ•°æ® -->
        <div style="padding: 20px;">
          <h3>ğŸ“ˆ è¯¦ç»†ç»Ÿè®¡</h3>
          <div id="preview-statistics"></div>
        </div>
        
        <!-- æ–‡å­—è¯„ä»· -->
        <div style="padding: 20px; background: #f5f5f5; border-radius: 0 0 10px 10px;">
          <h3>ğŸ¯ ç»¼åˆè¯„ä»·</h3>
          <div id="preview-evaluation"></div>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="generateImageExport()" class="btn success-btn">ğŸ–¼ï¸ ç”ŸæˆPNGå›¾ç‰‡</button>
        <button onclick="closeExportModal()" class="btn danger-btn">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- å„ç§åŠŸèƒ½æ¨¡æ€æ¡†ï¼ˆå¸‚åœºã€è´·æ¬¾ã€ä¿é™©ç­‰ï¼‰ -->
  <div id="feature-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeFeatureModal()">&times;</span>
      <div id="feature-content">
        <!-- åŠ¨æ€å†…å®¹ -->
      </div>
    </div>
  </div>

  <script>
    // æ¸¸æˆå¯åŠ¨æ—¶é—´
    let gameStartTime = Date.now();
    let actionCount = 0;

    // å…³é”®ä¿®å¤ï¼šé›†æˆä¿®å¤ç‰ˆçš„æ ¸å¿ƒæ¸¸æˆçŠ¶æ€
    let gameState = {
      money: 300,                    // ä¿®å¤ç‰ˆçš„å¹³è¡¡è®¾ç½®
      year: 1,
      season: 0,
      population: 80,               // ä¿®å¤ç‰ˆçš„å¹³è¡¡è®¾ç½®
      weather: 'æ­£å¸¸',
      currentCrop: null,
      crops: {
        'æ°´ç¨»': 0, 'å°éº¦': 0, 'ç‰ç±³': 0, 'å¤§è±†': 0, 'é«˜ç²±': 0, 
        'æ£‰èŠ±': 0, 'èŒ¶å¶': 0, 'ç”˜è”—': 0, 'æ©¡èƒ¶': 0, 'å’–å•¡': 0, 'å¯å¯': 0
      },
      farmerLevel: 1,
      totalIncome: 0,
      totalHarvests: 0,
      history: [],
      
      // å…³é”®ä¿®å¤ï¼šæ–°å¢ä¿®å¤ç‰ˆçš„æ ¸å¿ƒå˜é‡
      consecutiveFailures: 0,       // è¿ç»­å¤±è´¥æ¬¡æ•°
      survivalPressure: 0,          // ç”Ÿå­˜å‹åŠ›å€¼ 
      failureWarnings: 0,           // å¤±è´¥è­¦å‘Šæ¬¡æ•°
      isGameOver: false,            // æ¸¸æˆæ˜¯å¦ç»“æŸ
      
      // ä¿ç•™å®Œæ•´ç‰ˆçš„æ‰©å±•åŠŸèƒ½
      reputation: 0,
      planting: { exp: 0, level: 1 },
      management: { exp: 0, level: 1 },
      market: { exp: 0, level: 1 },
      weatherPrediction: false,
      nextWeatherEvent: null,
      researchPoints: 0,
      ongoingResearch: null,
      completedResearch: [],
      equipment: [],
      survivalEquipment: [],
      joinedCoops: [],
      activePolicies: [],
      randomEvents: [],
      achievements: [],
      environmentalHealth: 100,
      sustainabilityScore: 0,
      carbonFootprint: 0,
      difficulty: 70,
      gameMode: 'normal',
      birthplace: null,
      endlessYearMultiplier: 1.0,
      maxPopulationReached: 80,
      longestSurvivalStreak: 0,
      totalEquipmentPurchased: 0,
      totalResearchCompleted: 0,
      totalPoliciesApplied: 0,
      totalEventsExperienced: 0,
      playerActivity: {
        lastAction: Date.now(),
        afkWarnings: 0,
        totalIdleTime: 0
      }
    };

    // å¸‚åœºä»·æ ¼ç³»ç»Ÿï¼ˆå®Œæ•´ç‰ˆåŠŸèƒ½ï¼‰
    let marketPrices = {
      'æ°´ç¨»': 18, 'å°éº¦': 22, 'ç‰ç±³': 16, 'å¤§è±†': 25, 'é«˜ç²±': 20,
      'æ£‰èŠ±': 35, 'èŒ¶å¶': 55, 'ç”˜è”—': 12, 'æ©¡èƒ¶': 85, 'å’–å•¡': 105, 'å¯å¯': 140
    };

    // å…³é”®ä¿®å¤ï¼šé›†æˆä¿®å¤ç‰ˆçš„ä½œç‰©é…ç½®ï¼ˆä¿ç•™å®Œæ•´ç‰ˆçš„11ç§ä½œç‰©ï¼‰
    const CROPS = {
      'æ°´ç¨»': { baseYield: 60, basePrice: 18, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.3, 'æ´ªæ°´': 1.2, 'ç¾å®³': 0.1 }},
      'å°éº¦': { baseYield: 50, basePrice: 22, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.2, 'æ´ªæ°´': 0.8, 'ç¾å®³': 0.1 }},
      'ç‰ç±³': { baseYield: 70, basePrice: 16, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.4, 'æ´ªæ°´': 0.9, 'ç¾å®³': 0.1 }},
      'å¤§è±†': { baseYield: 40, basePrice: 25, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.5, 'æ´ªæ°´': 0.7, 'ç¾å®³': 0.1 }},
      'é«˜ç²±': { baseYield: 60, basePrice: 20, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.6, 'æ´ªæ°´': 0.4, 'ç¾å®³': 0.2 }},
      'æ£‰èŠ±': { baseYield: 40, basePrice: 35, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.2, 'æ´ªæ°´': 0.3, 'ç¾å®³': 0.1 }},
      'èŒ¶å¶': { baseYield: 25, basePrice: 55, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.5, 'æ´ªæ°´': 0.7, 'ç¾å®³': 0.2 }},
      'ç”˜è”—': { baseYield: 120, basePrice: 12, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.15, 'æ´ªæ°´': 0.8, 'ç¾å®³': 0.1 }},
      'æ©¡èƒ¶': { baseYield: 20, basePrice: 85, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.4, 'æ´ªæ°´': 0.6, 'ç¾å®³': 0.1 }},
      'å’–å•¡': { baseYield: 15, basePrice: 105, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.3, 'æ´ªæ°´': 0.5, 'ç¾å®³': 0.1 }},
      'å¯å¯': { baseYield: 12, basePrice: 140, modifiers: { 'æ­£å¸¸': 1.0, 'å¹²æ—±': 0.2, 'æ´ªæ°´': 0.6, 'ç¾å®³': 0.1 }}
    };

    // å…³é”®ä¿®å¤ï¼šé›†æˆä¿®å¤ç‰ˆçš„å¤©æ°”äº‹ä»¶é…ç½®ï¼ˆæ›´åŠ ä¸¥è‹›ï¼‰
    const WEATHER_EVENTS = [
      { type: 'æ­£å¸¸', probability: 0.15, severity: 0, description: 'é£è°ƒé›¨é¡º' },  // å¤§å¹…é™ä½æ­£å¸¸å¤©æ°”æ¦‚ç‡
      { type: 'å¹²æ—±', probability: 0.35, severity: 2, description: 'æŒç»­å¹²æ—±ï¼Œä½œç‰©å‡äº§' },
      { type: 'æ´ªæ°´', probability: 0.30, severity: 2, description: 'æ´ªæ°´æ³›æ»¥ï¼Œéƒ¨åˆ†ä½œç‰©è¢«æ·¹' },
      { type: 'ç¾å®³', probability: 0.20, severity: 4, description: 'æç«¯ç¾å®³ï¼' }
    ];

    // ===== å…³é”®ä¿®å¤ï¼šä¿®å¤ç‰ˆçš„æ ¸å¿ƒå‡½æ•° =====

    // é€‰æ‹©ä½œç‰©
    function chooseCrop(cropName) {
      if (gameState.isGameOver) return;
      
      gameState.currentCrop = cropName;
      
      // æ›´æ–°UI
      document.querySelectorAll('.crop-button').forEach(btn => {
        btn.classList.remove('selected');
      });
      event.target.classList.add('selected');
      
      addLog(`é€‰æ‹©ç§æ¤ä½œç‰©ï¼š${cropName}`, 'info');
      incrementActionCount();
      updateDisplay();
    }

    // ç”Ÿæˆå¤©æ°”äº‹ä»¶
    function generateWeatherEvent() {
      // æ ¹æ®ç”Ÿå­˜å‹åŠ›å¢åŠ ç¾å®³æ¦‚ç‡
      const pressureMultiplier = 1 + (gameState.survivalPressure / 100);
      const random = Math.random();
      let cumulative = 0;
      
      for (const event of WEATHER_EVENTS) {
        const adjustedProbability = event.probability * pressureMultiplier;
        cumulative += adjustedProbability;
        if (random <= cumulative) {
          return { ...event };
        }
      }
      
      return WEATHER_EVENTS[0]; // é»˜è®¤è¿”å›æ­£å¸¸å¤©æ°”
    }

    // è®¡ç®—æ”¶è·
    function calculateHarvest(weatherEvent) {
      if (!gameState.currentCrop) return { quantity: 0, income: 0 };
      
      const crop = CROPS[gameState.currentCrop];
      const weatherModifier = crop.modifiers[weatherEvent.type] || crop.modifiers['æ­£å¸¸'];
      
      let baseYield = crop.baseYield;
      let finalYield = baseYield * weatherModifier;
      
      // äººå£å½±å“äº§é‡ï¼ˆäººå£ä¸è¶³ä¼šä¸¥é‡å½±å“äº§å‡ºï¼‰
      const populationFactor = Math.min(1.0, gameState.population / 100);
      finalYield *= populationFactor;
      
      const quantity = Math.floor(finalYield);
      const income = Math.floor(quantity * crop.basePrice);
      
      return { quantity, income, weatherModifier, populationFactor };
    }

    // å…³é”®ä¿®å¤ï¼šå¤„ç†ç¾å®³åæœï¼ˆç§»é™¤äººå£ä¿åº•ï¼ï¼‰
    function handleDisasterConsequences(weatherEvent) {
      const severity = weatherEvent.severity;
      
      if (severity > 1) {
        // é‡‘é’±æŸå¤± - æ›´åŠ ä¸¥é‡
        const moneyLoss = Math.floor(gameState.money * (0.2 + severity * 0.15));
        gameState.money = Math.max(0, gameState.money - moneyLoss);
        
        // å…³é”®ä¿®å¤ï¼šäººå£æŸå¤± - ç§»é™¤ä¿åº•æœºåˆ¶ï¼
        const populationLoss = Math.floor(gameState.population * (0.1 + severity * 0.1));
        gameState.population = Math.max(0, gameState.population - populationLoss); // å…è®¸äººå£å½’é›¶ï¼
        
        // ä½œç‰©æŸå¤±
        Object.keys(gameState.crops).forEach(cropType => {
          if (gameState.crops[cropType] > 0) {
            const lossPercentage = 0.3 + Math.random() * 0.4;
            const lostAmount = Math.floor(gameState.crops[cropType] * lossPercentage);
            gameState.crops[cropType] = Math.max(0, gameState.crops[cropType] - lostAmount);
          }
        });
        
        if (moneyLoss > 0) addLog(`ğŸ’¸ ç¾å®³æŸå¤±ï¼šæŸå¤±â‚¹${moneyLoss}`, 'error');
        if (populationLoss > 0) addLog(`â˜ ï¸ äººå£æŸå¤±ï¼š${populationLoss}äºº`, 'error');
        
        // å¢åŠ è¿ç»­å¤±è´¥è®¡æ•°
        gameState.consecutiveFailures++;
        gameState.survivalPressure = Math.min(100, gameState.survivalPressure + severity * 10);
      } else {
        gameState.consecutiveFailures = Math.max(0, gameState.consecutiveFailures - 1);
        gameState.survivalPressure = Math.max(0, gameState.survivalPressure - 5);
      }
    }

    // å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ¸¸æˆå¤±è´¥æ¡ä»¶ï¼ˆæ–°å¢ï¼ï¼‰
    function checkGameFailure() {
      let failureReason = null;
      
      // äººå£å½’é›¶
      if (gameState.population <= 0) {
        failureReason = 'äººå£å…¨éƒ¨æ­»äº¡ï¼Œå†œåº„å½»åº•åºŸå¼ƒï¼';
      }
      // èµ„é‡‘ä¸è¶³ä¸”è¿ç»­å¤±è´¥
      else if (gameState.money <= 0 && gameState.consecutiveFailures >= 3) {
        failureReason = 'èµ„é‡‘è€—å°½ä¸”è¿ç»­ç¾å®³ï¼Œæ— æ³•ç»´æŒå†œåº„è¿è¥ï¼';
      }
      // ç”Ÿå­˜å‹åŠ›è¿‡é«˜
      else if (gameState.survivalPressure >= 100) {
        failureReason = 'ç”Ÿå­˜å‹åŠ›è¿‡å¤§ï¼Œå†œåº„å´©æºƒï¼';
      }
      // æç«¯æƒ…å†µï¼šäººå£è¿‡å°‘ä¸”èµ„é‡‘ä¸è¶³
      else if (gameState.population <= 5 && gameState.money <= 50) {
        failureReason = 'äººå£è¿‡å°‘ä¸”èµ„é‡‘çŸ­ç¼ºï¼Œå†œåº„æ— æ³•ç»´æŒï¼';
      }
      
      if (failureReason) {
        gameOver(failureReason);
        return true;
      }
      
      // å‘å‡ºè­¦å‘Š
      if ((gameState.population <= 10 || gameState.money <= 100 || gameState.survivalPressure >= 80) && gameState.failureWarnings < 3) {
        gameState.failureWarnings++;
        addLog(`âš ï¸ è­¦å‘Š${gameState.failureWarnings}/3ï¼šå†œåº„é¢ä¸´ä¸¥é‡å±æœºï¼`, 'warning');
        updateCriticalWarning();
      }
      
      return false;
    }

    // å…³é”®ä¿®å¤ï¼šæ¸¸æˆç»“æŸå‡½æ•°
    function gameOver(reason) {
      gameState.isGameOver = true;
      
      const stats = `
        <h3>å¤±è´¥åŸå› ï¼š${reason}</h3>
        <p><strong>å­˜æ´»å¹´æ•°ï¼š</strong>${gameState.year - 1}å¹´</p>
        <p><strong>æœ€ç»ˆäººå£ï¼š</strong>${gameState.population}äºº</p>
        <p><strong>æœ€ç»ˆèµ„é‡‘ï¼š</strong>â‚¹${gameState.money}</p>
        <p><strong>æ€»æ”¶å…¥ï¼š</strong>â‚¹${gameState.totalIncome}</p>
        <p><strong>ç”Ÿå­˜å‹åŠ›ï¼š</strong>${gameState.survivalPressure}%</p>
        <p><strong>è¿ç»­å¤±è´¥ï¼š</strong>${gameState.consecutiveFailures}æ¬¡</p>
      `;
      
      document.getElementById('game-over-stats').innerHTML = stats;
      document.getElementById('game-over-screen').style.display = 'flex';
      
      addLog(`ğŸ’€ æ¸¸æˆç»“æŸï¼š${reason}`, 'error');
    }

    // å…³é”®ä¿®å¤ï¼šæ›´æ–°ä¸´ç•Œè­¦å‘Šæ˜¾ç¤º
    function updateCriticalWarning() {
      const warningDiv = document.getElementById('critical-warning');
      if (gameState.failureWarnings > 0 || gameState.survivalPressure >= 60) {
        warningDiv.style.display = 'block';
        warningDiv.textContent = `âš ï¸ ä¸´ç•ŒçŠ¶æ€ï¼è­¦å‘Š ${gameState.failureWarnings}/3 | å‹åŠ› ${gameState.survivalPressure}%`;
      } else {
        warningDiv.style.display = 'none';
      }
    }

    // é‡æ–°å¼€å§‹æ¸¸æˆ
    function restartGame() {
      gameState = {
        money: 300,
        year: 1,
        season: 0,
        population: 80,
        weather: 'æ­£å¸¸',
        currentCrop: null,
        crops: {
          'æ°´ç¨»': 0, 'å°éº¦': 0, 'ç‰ç±³': 0, 'å¤§è±†': 0, 'é«˜ç²±': 0, 
          'æ£‰èŠ±': 0, 'èŒ¶å¶': 0, 'ç”˜è”—': 0, 'æ©¡èƒ¶': 0, 'å’–å•¡': 0, 'å¯å¯': 0
        },
        farmerLevel: 1,
        totalIncome: 0,
        totalHarvests: 0,
        history: [],
        consecutiveFailures: 0,
        survivalPressure: 0,
        failureWarnings: 0,
        isGameOver: false,
        reputation: 0,
        planting: { exp: 0, level: 1 },
        management: { exp: 0, level: 1 },
        market: { exp: 0, level: 1 },
        weatherPrediction: false,
        nextWeatherEvent: null,
        researchPoints: 0,
        ongoingResearch: null,
        completedResearch: [],
        equipment: [],
        survivalEquipment: [],
        joinedCoops: [],
        activePolicies: [],
        randomEvents: [],
        achievements: [],
        environmentalHealth: 100,
        sustainabilityScore: 0,
        carbonFootprint: 0,
        difficulty: 70,
        gameMode: 'normal',
        birthplace: null,
        endlessYearMultiplier: 1.0,
        maxPopulationReached: 80,
        longestSurvivalStreak: 0,
        totalEquipmentPurchased: 0,
        totalResearchCompleted: 0,
        totalPoliciesApplied: 0,
        totalEventsExperienced: 0,
        playerActivity: {
          lastAction: Date.now(),
          afkWarnings: 0,
          totalIdleTime: 0
        }
      };
      
      document.getElementById('game-over-screen').style.display = 'none';
      document.getElementById('log-container').innerHTML = '';
      document.querySelectorAll('.crop-button').forEach(btn => btn.classList.remove('selected'));
      
      addLog('æ¸¸æˆé‡æ–°å¼€å§‹ï¼v2.6ä¿®å¤ç‰ˆæ¿€æ´»ï¼', 'info');
      addLog('è­¦å‘Šï¼šäººå£å¯èƒ½å®Œå…¨æ­»äº¡ï¼Œæ— é™ç”Ÿå­˜æ¼æ´å·²ä¿®å¤ï¼', 'warning');
      updateDisplay();
    }

    // å…³é”®ä¿®å¤ï¼šä¸‹ä¸€å›åˆï¼ˆé›†æˆä¿®å¤ç‰ˆçš„æ£€æŸ¥ï¼‰
    function nextTurn() {
      if (gameState.isGameOver) return;
      
      if (!gameState.currentCrop) {
        addLog('è¯·å…ˆé€‰æ‹©è¦ç§æ¤çš„ä½œç‰©ï¼', 'warning');
        return;
      }
      
      incrementActionCount();
      
      // ç”Ÿæˆå¤©æ°”äº‹ä»¶
      const weatherEvent = generateWeatherEvent();
      gameState.weather = weatherEvent.type;
      
      // è®¡ç®—æ”¶è·
      const harvestResult = calculateHarvest(weatherEvent);
      
      // æ›´æ–°æ¸¸æˆçŠ¶æ€
      gameState.year++;
      gameState.money += harvestResult.income;
      gameState.totalIncome += harvestResult.income;
      gameState.crops[gameState.currentCrop] += harvestResult.quantity;
      gameState.totalHarvests++;
      
      // å…³é”®ä¿®å¤ï¼šå¤„ç†ç¾å®³åæœ
      handleDisasterConsequences(weatherEvent);
      
      // å…³é”®ä¿®å¤ï¼šæ£€æŸ¥å¤±è´¥æ¡ä»¶
      if (checkGameFailure()) {
        return;
      }
      
      // è®°å½•æ—¥å¿—
      let logMessage = `ç¬¬${gameState.year - 1}å¹´ï¼š${weatherEvent.type}ï¼Œæ”¶è·${gameState.currentCrop} ${harvestResult.quantity}å•ä½ï¼Œæ”¶å…¥â‚¹${harvestResult.income}`;
      const logType = weatherEvent.severity > 2 ? 'error' : weatherEvent.severity > 1 ? 'warning' : 'success';
      addLog(logMessage, logType);
      
      // æ›´æ–°å†å²è®°å½•
      gameState.history.push({
        year: gameState.year - 1,
        weather: weatherEvent.type,
        income: harvestResult.income,
        crop: gameState.currentCrop
      });
      
      // æ›´æ–°æ˜¾ç¤º
      updateDisplay();
      updateEnhancedDisplay();
      updateMarketPrices();
      updateHistoryDisplay();
    }

    // æ·»åŠ æ—¥å¿—
    function addLog(message, type = 'info') {
      const logDiv = document.getElementById('log-container');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[ç¬¬${gameState.year}å¹´] ${message}`;
      
      logDiv.insertBefore(entry, logDiv.firstChild);
      
      // ä¿æŒæ—¥å¿—æ•°é‡åˆç†
      if (logDiv.children.length > 50) {
        logDiv.removeChild(logDiv.lastChild);
      }
    }

    // å…³é”®ä¿®å¤ï¼šæ›´æ–°æ˜¾ç¤ºï¼ˆé›†æˆä¸¤ä¸ªç‰ˆæœ¬ï¼‰
    function updateDisplay() {
      document.getElementById('money-display').textContent = gameState.money;
      document.getElementById('year-display').textContent = gameState.year;
      document.getElementById('population-display').textContent = gameState.population;
      document.getElementById('weather-display').textContent = gameState.weather;
      document.getElementById('current-crop-display').textContent = gameState.currentCrop || 'æœªé€‰æ‹©';
      document.getElementById('farmer-level-display').textContent = gameState.farmerLevel;
      document.getElementById('reputation-display').textContent = gameState.reputation;
      
      // å…³é”®ä¿®å¤ï¼šæ˜¾ç¤ºç”Ÿå­˜å‹åŠ›å’Œå¤±è´¥è­¦å‘Š
      document.getElementById('survival-pressure-display').textContent = gameState.survivalPressure + '%';
      document.getElementById('failure-warnings-display').textContent = `${gameState.failureWarnings}/3`;
      
      // æ›´æ–°çŠ¶æ€é¢œè‰²
      const moneyElement = document.getElementById('money-display');
      const populationElement = document.getElementById('population-display');
      const pressureElement = document.getElementById('survival-pressure-display');
      
      moneyElement.style.color = gameState.money < 100 ? '#ff0000' : '#4CAF50';
      populationElement.style.color = gameState.population < 20 ? '#ff0000' : '#2196F3';
      pressureElement.style.color = gameState.survivalPressure > 60 ? '#ff0000' : '#333';
      
      updateCriticalWarning();
    }

    // ===== å®Œæ•´ç‰ˆçš„æ‰©å±•åŠŸèƒ½ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰ =====

    // å¢åŠ æ“ä½œè®¡æ•°
    function incrementActionCount() {
      actionCount++;
      gameState.playerActivity.lastAction = Date.now();
    }

    // å¢å¼ºçš„æ¸¸æˆçŠ¶æ€æ›´æ–°
    function updateEnhancedDisplay() {
      // æ›´æ–°æ¸¸æˆæ—¶é•¿
      const gameTime = Math.floor((Date.now() - gameStartTime) / 60000);
      document.getElementById('game-duration').textContent = gameTime;
      
      // æ›´æ–°æ“ä½œæ¬¡æ•°å’ŒAPM
      document.getElementById('action-count').textContent = actionCount;
      const apm = gameTime > 0 ? Math.round(actionCount / gameTime) : 0;
      document.getElementById('apm').textContent = apm;
      
      // æ›´æ–°æ•ˆç‡è¯„åˆ†
      const efficiency = Math.min(100, Math.round((gameState.totalIncome / Math.max(1, gameState.year)) / 100));
      document.getElementById('efficiency-score').textContent = efficiency;
      
      // æ›´æ–°ç»Ÿè®¡æ•°æ®
      document.getElementById('total-equipment').textContent = gameState.totalEquipmentPurchased;
      document.getElementById('total-research').textContent = gameState.totalResearchCompleted;
      document.getElementById('total-policies').textContent = gameState.totalPoliciesApplied;
      document.getElementById('total-events').textContent = gameState.totalEventsExperienced;
      document.getElementById('max-population').textContent = gameState.maxPopulationReached;
      document.getElementById('longest-streak').textContent = gameState.longestSurvivalStreak;
      document.getElementById('env-score').textContent = gameState.environmentalHealth;
      
      // æ›´æ–°ç¯å¢ƒç³»ç»Ÿ
      document.getElementById('environmental-health').textContent = gameState.environmentalHealth;
      document.getElementById('sustainability-score').textContent = gameState.sustainabilityScore;
      document.getElementById('carbon-footprint').textContent = gameState.carbonFootprint;
      document.getElementById('environmental-progress').style.width = gameState.environmentalHealth + '%';
    }

    // æ›´æ–°å¸‚åœºä»·æ ¼
    function updateMarketPrices() {
      Object.keys(marketPrices).forEach(crop => {
        const volatility = 0.1 + Math.random() * 0.2;
        const change = (Math.random() - 0.5) * volatility;
        marketPrices[crop] = Math.max(1, marketPrices[crop] * (1 + change));
      });
    }

    // æ›´æ–°å†å²æ˜¾ç¤º
    function updateHistoryDisplay() {
      const tbody = document.getElementById('history-body');
      tbody.innerHTML = gameState.history.slice(-10).reverse().map(record => `
        <tr>
          <td>${record.year}</td>
          <td>${record.weather}</td>
          <td>â‚¹${record.income}</td>
          <td>${record.crop}</td>
        </tr>
      `).join('');
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    function initializeGame() {
      addLog('æ¬¢è¿æ¥åˆ°å­£é£å†³ç­–è€…v2.6.2-overlay').style.display = 'none';
      document.getElementById('birthplace-overlay').style.display = 'block';
    }
    function selectBirthplace(place) {
      gameState.birthplace = place;
      document.getElementById('birthplace-overlay').style.display = 'none';
      addLog(`é€‰æ‹©å‡ºç”Ÿåœ°ï¼š${place}`, 'info');
    }
    function selectDifficulty(level) {
      gameState.difficulty = level;
      addLog(`è®¾ç½®éš¾åº¦ï¼š${level}%`, 'info');
    }
    function selectGameMode(mode) {
      gameState.gameMode = mode;
      addLog(`é€‰æ‹©æ¸¸æˆæ¨¡å¼ï¼š${mode}`, 'info');
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('load', function() {
      initializeGame();
    });
  </script>
</body>

</html>
