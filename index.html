<!DOCTYPE html>
<html>

<head>
    <title>å­£é£å†³ç­–è€…</title>
    <link rel="icon" href="./f.ico">
    <style>
        :root {
            --flood-color: #006994;
            --drought-color: #8B4513;
            --primary-bg: #f0f8ff;
            --secondary-bg: #fff;
            --accent-color: #4682B4;
            --policy-bg: #fff9e6;
            --policy-border: #ffd700;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--primary-bg);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 20px;
            width: 100%;
        }

        #map {
            height: 250px;
            background: linear-gradient(160deg, #4d7c3f 0%, #87CEEB 100%);
            border-radius: 10px;
            transition: all 0.5s;
            position: relative;
            overflow: hidden;
        }

        .satellite-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: 40px 40px;
            opacity: 0.7;
        }

        .policy-card {
            background: var(--policy-bg);
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid var(--policy-border);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th {
            background: var(--accent-color);
            color: white;
        }

        .history-table td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        @keyframes flood-pulse {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 40px 40px;
            }
        }

        @keyframes drought-pulse {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 40px -40px;
            }
        }

        .flood-effect {
            background-image: linear-gradient(45deg,
                    var(--flood-color) 25%,
                    transparent 25%,
                    transparent 50%,
                    var(--flood-color) 50%,
                    var(--flood-color) 75%,
                    transparent 75%);
            animation: flood-pulse 2s linear infinite;
        }

        .drought-effect {
            background-image: linear-gradient(45deg,
                    var(--drought-color) 25%,
                    transparent 25%,
                    transparent 50%,
                    var(--drought-color) 50%,
                    var(--drought-color) 75%,
                    transparent 75%);
            animation: drought-pulse 2s linear infinite;
        }

        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }

        button:hover {
            background: #356a93;
        }

        #log {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: var(--secondary-bg);
            border-radius: 5px;
        }

        #target-money-setting {
            margin-bottom: 20px;
        }

        #location-info {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="grid-container">
        <!-- ä¸»æ¸¸æˆåŒº -->
        <div>
            <h1>ğŸŒ¦ï¸ å­£é£å†³ç­–è€… ğŸšœ</h1>
            <div id="target-money-setting">
                <label for="target-money">è®¾ç½®ç›®æ ‡é‡‘é’±:</label>
                <input type="number" id="target-money" value="5000">
                <button onclick="setTargetMoney()">ç¡®å®š</button>
            </div>
            <div id="map"></div>

            <div id="controls">
                <h3>ğŸ’° èµ„é‡‘: â‚¹<span id="money">1000</span></h3>
                <div id="current-policy" class="policy-card"></div>

                <h3>ğŸŒ± é€‰æ‹©ä½œç‰©:</h3>
                <div id="crop-buttons"></div>

                <h3>ğŸ› ï¸ å†œä¸šè®¾å¤‡:</h3>
                <div id="equipment-buttons"></div>

                <h3>ğŸ‘·â€â™‚ï¸ é›‡ä½£åŠ³åŠ¨åŠ›:</h3>
                <div id="labor-buttons"></div>

                <button onclick="startNewYear()" style="margin:20px 0">â© è¿›å…¥ä¸‹ä¸€å¹´</button>
            </div>

            <div id="log"></div>
        </div>

        <!-- ä¿¡æ¯é¢æ¿ -->
        <div>
            <h3>ğŸ“œ å½“å‰æ”¿ç­–</h3>
            <div id="policy-effect"></div>

            <h3>ğŸ“Š å†å²æ•°æ®</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>å¹´ä»½</th>
                        <th>å­£é£</th>
                        <th>æ”¶å…¥</th>
                        <th>æ”¿ç­–</th>
                        <th>åŠ³åŠ¨åŠ›æˆæœ¬</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>

            <h3>ğŸŒ æ°”å€™å˜åŒ–æŒ‡æ•°</h3>
            <div id="climate-meter">æç«¯å¤©æ°”æ¦‚ç‡: 15%</div>

            <h3>ğŸ“š å¸®åŠ©ä¿¡æ¯</h3>
            <div id="help-info">
                <p>ğŸŒ± é€‰æ‹©åˆé€‚çš„ä½œç‰©ï¼Œä¸åŒä½œç‰©å¯¹å­£é£çš„é€‚åº”èƒ½åŠ›ä¸åŒã€‚</p>
                <p>ğŸ› ï¸ è´­ä¹°å†œä¸šè®¾å¤‡å¯ä»¥æé«˜ä½œç‰©äº§é‡ã€‚</p>
                <p>ğŸ‘·â€â™‚ï¸ é›‡ä½£åŠ³åŠ¨åŠ›èƒ½æé«˜å·¥ä½œæ•ˆç‡ï¼Œä½†ä¼šå¢åŠ æˆæœ¬ã€‚</p>
                <p>ğŸ“œ æ”¿ç­–ä¼šå½±å“ä½ çš„æ”¶å…¥å’Œæˆæœ¬ï¼Œæ³¨æ„åº”å¯¹ã€‚</p>
                <p>ğŸŒ æ°”å€™å˜åŒ–æŒ‡æ•°ä¼šå½±å“æç«¯å¤©æ°”çš„æ¦‚ç‡ï¼Œæ³¨æ„åº”å¯¹ã€‚</p>
            </div>
        </div>
    </div>
    <div id="location-info">
        <h3>å½“å‰å‡ºç”Ÿåœ°ä¿¡æ¯</h3>
        <p id="location-description"></p>
    </div>

    <!-- è§„åˆ™å¼¹çª— -->
    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRulesModal()">&times;</span>
            <h2>æ¸¸æˆè§„åˆ™å’Œæœºåˆ¶ç®€ä»‹</h2>
            <p>ä½ å°†æ‰®æ¼”ä¸€ä½å†œä¸šå†³ç­–è€…ï¼Œåœ¨ä¸åŒçš„åœ°åŒºç»è¥å†œåœºã€‚æ¸¸æˆç›®æ ‡æ˜¯åœ¨10å¹´å†…ç§¯ç´¯è¶³å¤Ÿçš„èµ„é‡‘è¾¾åˆ°è®¾å®šçš„ç›®æ ‡é‡‘é’±ã€‚</p>
            <p>1. é€‰æ‹©å‡ºç”Ÿåœ°ï¼šæ¸¸æˆå¼€å§‹æ—¶ï¼Œä½ å°†éšæœºå‡ºç”Ÿåœ¨ä¸€ä¸ªåœ°åŒºï¼Œæ¯ä¸ªåœ°åŒºæœ‰ä¸åŒçš„æ°”å€™é£é™©ã€é€‚åˆç§æ¤çš„ä½œç‰©å’Œæ”¿ç­–ã€‚</p>
            <p>2. è®¾ç½®ç›®æ ‡é‡‘é’±ï¼šåœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼Œä½ å¯ä»¥è®¾ç½®ç›®æ ‡é‡‘é’±ï¼Œè®¾ç½®åæ— æ³•é‡æ–°è®¾ç½®ã€‚</p>
            <p>3. é€‰æ‹©ä½œç‰©ï¼šæ ¹æ®æ‰€åœ¨åœ°åŒºï¼Œé€‰æ‹©é€‚åˆç§æ¤çš„ä½œç‰©ã€‚ä¸åŒä½œç‰©å¯¹å­£é£çš„é€‚åº”èƒ½åŠ›ä¸åŒã€‚</p>
            <p>4. è´­ä¹°è®¾å¤‡ï¼šè´­ä¹°å†œä¸šè®¾å¤‡å¯ä»¥æé«˜ä½œç‰©äº§é‡ï¼Œåº”å¯¹ä¸åŒçš„æ°”å€™ç¾å®³ã€‚</p>
            <p>5. é›‡ä½£åŠ³åŠ¨åŠ›ï¼šé›‡ä½£åŠ³åŠ¨åŠ›èƒ½æé«˜å·¥ä½œæ•ˆç‡ï¼Œä½†ä¼šå¢åŠ æˆæœ¬ã€‚</p>
            <p>6. åº”å¯¹æ”¿ç­–ï¼šæ”¿åºœä¼šéšæœºé¢å¸ƒæ”¿ç­–ï¼Œå½±å“ä½ çš„æ”¶å…¥å’Œæˆæœ¬ã€‚</p>
            <p>7. åº”å¯¹æ°”å€™å˜åŒ–ï¼šéšç€æ¸¸æˆè¿›è¡Œï¼Œæ°”å€™å˜åŒ–æŒ‡æ•°ä¼šä¸Šå‡ï¼Œæç«¯å¤©æ°”çš„æ¦‚ç‡å¢åŠ ã€‚</p>
            <p>8. æ”¶è·æ”¶å…¥ï¼šæ¯å¹´æ”¶è·æ—¶ï¼Œæ ¹æ®ä½œç‰©äº§é‡ã€æ”¿ç­–å’Œæ°”å€™å˜åŒ–ç­‰å› ç´ è®¡ç®—æ”¶å…¥ã€‚</p>
            <p>9. æ¸¸æˆèƒœåˆ©å’Œå¤±è´¥ï¼šå¦‚æœåœ¨10å¹´å†…ç§¯ç´¯çš„èµ„é‡‘è¾¾åˆ°æˆ–è¶…è¿‡ç›®æ ‡é‡‘é’±ï¼Œæ¸¸æˆèƒœåˆ©ï¼›å¦‚æœèµ„é‡‘ä¸è¶³ï¼Œæ¸¸æˆå¤±è´¥ã€‚</p>
	    <p>ï¼ˆåˆä¸€å››ç­ ç‹å­é¾™ååŠ©åˆ¶ä½œï¼‰</p>
        </div>
    </div>

    <script>
        let gameState = {
            money: 1000,
            currentCrop: null,
            equipment: [],
            policies: [],
            history: [],
            climateRisk: 15,
            year: 2023,
            incomeMultiplier: 1,
            equipmentCost: 1,
            location: null,
            labor: 0,
            laborCost: 0,
            targetMoney: 5000,
            targetMoneySet: false
        };

        const LOCATIONS = [
            {
                name: "ä¿„ç½—æ–¯",
                climateRisk: 10,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 0.8 },
                    { type: "ä½æ¸©éœœå†»", yieldFactor: 0.2 },
                    { type: "æš´é›¨æ´ªæ¶", yieldFactor: 0.4 },
                    { type: "æš´é›ª", yieldFactor: 0.1 },
                    { type: "æå¯’", yieldFactor: 0.15 }
                ],
                suitableCrops: ["å°éº¦", "å¤§éº¦", "äºšéº»"],
                policies: [
                    {
                        name: "å†œä¸šè¡¥è´´",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸ’¸ æ”¿åºœæä¾›å†œä¸šè¡¥è´´ï¼Œæ”¶å…¥å¢åŠ 10%"
                    },
                    {
                        name: "æŠ€æœ¯æ”¯æŒ",
                        effect: () => gameState.equipmentCost = 0.9,
                        description: "ğŸ’¡ æ”¿åºœæä¾›æŠ€æœ¯æ”¯æŒï¼Œè®¾å¤‡ä»·æ ¼é™ä½10%"
                    },
                    {
                        name: "åœŸåœ°ä¼˜æƒ ",
                        effect: () => gameState.money += 200,
                        description: "ğŸ’¸ æ”¿åºœç»™äºˆåœŸåœ°ä½¿ç”¨ä¼˜æƒ ï¼Œèµ„é‡‘å¢åŠ â‚¹200"
                    }
                ],
                laborCostRate: 20,
                description: "ä¿„ç½—æ–¯åœ°åŸŸå¹¿é˜”ï¼Œå†¬å­£å¯’å†·æ¼«é•¿ï¼Œå¤å­£æ¸©æš–çŸ­ä¿ƒã€‚å†œä¸šä¸»è¦é›†ä¸­åœ¨å—éƒ¨åœ°åŒºï¼Œä½æ¸©éœœå†»å’Œæš´é›ªç­‰ç¾å®³è¾ƒä¸ºå¸¸è§ã€‚ç”±äºåœ°å¹¿äººç¨€ï¼ŒåŠ³åŠ¨åŠ›æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚é€‚åˆç§æ¤è€å¯’çš„ä½œç‰©ï¼Œå¦‚å°éº¦ã€å¤§éº¦å’Œäºšéº»ã€‚"
            },
            {
                name: "ä¸œå—äºš",
                climateRisk: 20,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 1.2 },
                    { type: "å°é£", yieldFactor: 0.3 },
                    { type: "æ´ªæ°´", yieldFactor: 0.5 },
                    { type: "æ³¥çŸ³æµ", yieldFactor: 0.2 },
                    { type: "æ£®æ—ç«ç¾", yieldFactor: 0.35 }
                ],
                suitableCrops: ["æ°´ç¨»", "æ©¡èƒ¶", "æ£•æ¦ˆæ²¹"],
                policies: [
                    {
                        name: "å‡ºå£é¼“åŠ±",
                        effect: () => gameState.incomeMultiplier *= 1.3,
                        description: "ğŸŒ æ”¿åºœé¼“åŠ±å‡ºå£ï¼Œæ”¶å…¥å¢åŠ 30%"
                    },
                    {
                        name: "ç¾å®³æ•‘æ´",
                        effect: () => gameState.money += 300,
                        description: "ğŸ’¸ æ”¿åºœæä¾›ç¾å®³æ•‘æ´èµ„é‡‘â‚¹300"
                    },
                    {
                        name: "å†œä¸šåŸ¹è®­",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸ’¡ æ”¿åºœå¼€å±•å†œä¸šåŸ¹è®­ï¼Œæ”¶å…¥å¢åŠ 10%"
                    }
                ],
                laborCostRate: 10,
                description: "ä¸œå—äºšåœ°å¤„çƒ­å¸¦ï¼Œæ°”å€™ç‚çƒ­å¤šé›¨ï¼Œæ˜¯ä¸–ç•Œä¸Šé‡è¦çš„æ°´ç¨»ã€æ©¡èƒ¶å’Œæ£•æ¦ˆæ²¹äº§åŒºã€‚å°é£ã€æ´ªæ°´å’Œæ³¥çŸ³æµç­‰ç¾å®³é¢‘ç¹ã€‚åŠ³åŠ¨åŠ›èµ„æºä¸°å¯Œï¼Œæˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚"
            },
            {
                name: "å°åº¦",
                climateRisk: 25,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 1 },
                    { type: "å¹²æ—±", yieldFactor: 0.3 },
                    { type: "æ´ªæ°´", yieldFactor: 0.5 },
                    { type: "çƒ­æµª", yieldFactor: 0.25 },
                    { type: "è—è™«ç¾å®³", yieldFactor: 0.1 }
                ],
                suitableCrops: ["æ°´ç¨»", "å°éº¦", "æ£‰èŠ±", "ç”˜è”—"],
                policies: [
                    {
                        name: "å†œä¸šä¿é™©è¡¥è´´",
                        effect: () => gameState.incomeMultiplier *= 1.15,
                        description: "ğŸ’¸ æ”¿åºœè¡¥è´´å†œä¸šä¿é™©ï¼Œæ”¶å…¥å¢åŠ 15%"
                    },
                    {
                        name: "æ°´åˆ©å»ºè®¾",
                        effect: () => gameState.equipmentCost = 0.85,
                        description: "ğŸ’¡ æ”¿åºœè¿›è¡Œæ°´åˆ©å»ºè®¾ï¼Œè®¾å¤‡ä»·æ ¼é™ä½15%"
                    },
                    {
                        name: "ç²®é£Ÿæ”¶è´­",
                        effect: () => gameState.incomeMultiplier *= 1.2,
                        description: "ğŸŒ¾ æ”¿åºœé«˜ä»·æ”¶è´­ç²®é£Ÿï¼Œæ”¶å…¥å¢åŠ 20%"
                    }
                ],
                laborCostRate: 5,
                description: "å°åº¦äººå£ä¼—å¤šï¼ŒåŠ³åŠ¨åŠ›ä½å»‰ã€‚å±äºçƒ­å¸¦å­£é£æ°”å€™ï¼Œæ—±å­£å’Œé›¨å­£åˆ†æ˜ï¼Œå¹²æ—±ã€æ´ªæ°´å’Œçƒ­æµªç­‰ç¾å®³æ—¶æœ‰å‘ç”Ÿã€‚æ˜¯é‡è¦çš„å†œä¸šå›½å®¶ï¼Œä¸»è¦ç§æ¤æ°´ç¨»ã€å°éº¦ã€æ£‰èŠ±å’Œç”˜è”—ç­‰ä½œç‰©ã€‚"
            },
            {
                name: "ä¸­å›½å—æ–¹",
                climateRisk: 22,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 1.1 },
                    { type: "æ¢…é›¨æ´ªæ¶", yieldFactor: 0.4 },
                    { type: "ä¼æ—±", yieldFactor: 0.3 },
                    { type: "å°é£", yieldFactor: 0.35 },
                    { type: "å±±ä½“æ»‘å¡", yieldFactor: 0.2 }
                ],
                suitableCrops: ["æ°´ç¨»", "èŒ¶å¶", "æŸ‘æ©˜"],
                policies: [
                    {
                        name: "å†œä¸šç§‘æŠ€åˆ›æ–°",
                        effect: () => gameState.incomeMultiplier *= 1.2,
                        description: "ğŸ’¡ æ”¿åºœæ¨åŠ¨å†œä¸šç§‘æŠ€åˆ›æ–°ï¼Œæ”¶å…¥å¢åŠ 20%"
                    },
                    {
                        name: "æŠ—æ—±æ•‘ç¾",
                        effect: () => gameState.money += 250,
                        description: "ğŸ’¸ æ”¿åºœæä¾›æŠ—æ—±æ•‘ç¾èµ„é‡‘â‚¹250"
                    },
                    {
                        name: "ç”Ÿæ€å†œä¸šè¡¥è´´",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸŒ³ æ”¿åºœè¡¥è´´ç”Ÿæ€å†œä¸šï¼Œæ”¶å…¥å¢åŠ 10%"
                    }
                ],
                laborCostRate: 15,
                description: "ä¸­å›½å—æ–¹æ°”å€™æ¸©æš–æ¹¿æ¶¦ï¼Œé›¨é‡å……æ²›ï¼Œæ˜¯é‡è¦çš„æ°´ç¨»ã€èŒ¶å¶å’ŒæŸ‘æ©˜äº§åŒºã€‚æ¢…é›¨æ´ªæ¶ã€ä¼æ—±å’Œå°é£ç­‰ç¾å®³è¾ƒä¸ºå¸¸è§ã€‚å†œä¸šç§‘æŠ€æ°´å¹³è¾ƒé«˜ï¼Œæ”¿åºœæ³¨é‡ç”Ÿæ€å†œä¸šå‘å±•ã€‚"
            },
            {
                name: "ä¸­å›½åŒ—æ–¹",
                climateRisk: 18,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 0.9 },
                    { type: "å¹²æ—±", yieldFactor: 0.2 },
                    { type: "æš´é›¨", yieldFactor: 0.5 },
                    { type: "æ²™å°˜æš´", yieldFactor: 0.15 },
                    { type: "å¯’æ½®", yieldFactor: 0.2 }
                ],
                suitableCrops: ["å°éº¦", "ç‰ç±³", "å¤§è±†"],
                policies: [
                    {
                        name: "èŠ‚æ°´çŒæº‰æ¨å¹¿",
                        effect: () => gameState.equipmentCost = 0.9,
                        description: "ğŸ’¡ æ”¿åºœæ¨å¹¿èŠ‚æ°´çŒæº‰ï¼Œè®¾å¤‡ä»·æ ¼é™ä½10%"
                    },
                    {
                        name: "å†œä¸šä¿¡è´·æ”¯æŒ",
                        effect: () => gameState.money += 200,
                        description: "ğŸ’¸ æ”¿åºœæä¾›å†œä¸šä¿¡è´·æ”¯æŒâ‚¹200"
                    },
                    {
                        name: "é»‘åœŸåœ°ä¿æŠ¤",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸŒ± æ”¿åºœä¿æŠ¤é»‘åœŸåœ°ï¼Œæ”¶å…¥å¢åŠ 10%"
                    }
                ],
                laborCostRate: 12,
                description: "ä¸­å›½åŒ—æ–¹ä»¥æ¸©å¸¦å­£é£æ°”å€™ä¸ºä¸»ï¼Œé™æ°´ç›¸å¯¹è¾ƒå°‘ï¼Œå¹²æ—±å’Œæ²™å°˜æš´ç­‰ç¾å®³è¾ƒä¸ºå¸¸è§ã€‚æ˜¯é‡è¦çš„å°éº¦ã€ç‰ç±³å’Œå¤§è±†äº§åŒºï¼Œæ”¿åºœé‡è§†èŠ‚æ°´çŒæº‰å’Œé»‘åœŸåœ°ä¿æŠ¤ã€‚"
            }
        ];

        function initGame() {
            // æ˜¾ç¤ºè§„åˆ™å¼¹çª—
            showRulesModal();
            const randomIndex = Math.floor(Math.random() * LOCATIONS.length);
            gameState.location = LOCATIONS[randomIndex];
            gameState.climateRisk = gameState.location.climateRisk;
            document.getElementById('climate-meter').textContent = `æç«¯å¤©æ°”æ¦‚ç‡: ${gameState.climateRisk}%`;

            const cropButtons = document.getElementById('crop-buttons');
            cropButtons.innerHTML = '';
            gameState.location.suitableCrops.forEach(crop => {
                const button = document.createElement('button');
                button.textContent = `ğŸŒ¾ ${crop}`;
                button.onclick = () => chooseCrop(crop);
                cropButtons.appendChild(button);
            });

            const equipmentButtons = document.getElementById('equipment-buttons');
            equipmentButtons.innerHTML = '';
            const equipmentList = [
                { name: "çŒæº‰è®¾å¤‡", cost: 300 },
                { name: "é˜²æ´ªè®¾æ–½", cost: 500 },
                { name: "æ°”è±¡ç›‘æµ‹ä»ª", cost: 400 },
                { name: "é™¤è™«è®¾å¤‡", cost: 200 },
                { name: "ä¿æš–è®¾å¤‡", cost: 250 }
            ];
            equipmentList.forEach(item => {
                const button = document.createElement('button');
                button.textContent = `ğŸ’§ ${item.name} (â‚¹${item.cost})`;
                button.onclick = () => buyItem(item.name, item.cost);
                equipmentButtons.appendChild(button);
            });

            const laborButtons = document.getElementById('labor-buttons');
            laborButtons.innerHTML = '';
            [1, 2, 3, 4, 5].forEach(num => {
                const button = document.createElement('button');
                button.textContent = `ğŸ‘·â€â™‚ï¸ é›‡ä½£ ${num} äºº (â‚¹${num * gameState.location.laborCostRate})`;
                button.onclick = () => hireLabor(num);
                laborButtons.appendChild(button);
            });

            updateDisplay();
            addLog(`æ¬¢è¿æ¥åˆ°å­£é£å†³ç­–è€…ï¼ä½ å‡ºç”Ÿåœ¨ ${gameState.location.name}ï¼Œè¯·å…ˆé€‰æ‹©ç§æ¤ä½œç‰©`);
            showLocationInfo();
        }

        function setTargetMoney() {
            if (gameState.targetMoneySet) {
                addLog('ç›®æ ‡é‡‘é’±å·²è®¾ç½®ï¼Œæ— æ³•é‡æ–°è®¾ç½®ï¼');
                return;
            }
            const target = parseInt(document.getElementById('target-money').value);
            if (!isNaN(target) && target > 0) {
                gameState.targetMoney = target;
                gameState.targetMoneySet = true;
                addLog(`ç›®æ ‡é‡‘é’±å·²è®¾ç½®ä¸º â‚¹${target}`);
                // ç¦ç”¨è¾“å…¥æ¡†å’ŒæŒ‰é’®
                document.getElementById('target-money').disabled = true;
                document.querySelector('#target-money-setting button').disabled = true;
            } else {
                addLog('è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡é‡‘é’±ï¼');
            }
        }

        function updateClimate() {
            gameState.climateRisk = Math.min(50, gameState.climateRisk + 2);
            document.getElementById('climate-meter').textContent =
                `æç«¯å¤©æ°”æ¦‚ç‡: ${gameState.climateRisk}%`;
        }

        function applyRandomPolicy() {
            if (Math.random() < 0.6) return; // 60%å‡ ç‡æ— æ”¿ç­–

            const policy = gameState.location.policies[Math.floor(Math.random() * gameState.location.policies.length)];
            policy.effect();
            gameState.policies.push(policy.name);

            const policyDiv = document.getElementById('policy-effect');
            policyDiv.innerHTML = `
                <h4>ğŸ“œ æ–°æ”¿ç­–é¢å¸ƒï¼š${policy.name}</h4>
                <p>${policy.description}</p>
            `;
            // å¼¹çª—æ˜¾ç¤ºæ–°æ”¿ç­–
            alert(`æ–°æ”¿ç­–é¢å¸ƒï¼š${policy.name}\n${policy.description}`);
        }

        function updateMapEffect(scenario) {
            const map = document.getElementById('map');
            map.className = '';
            map.innerHTML = '';

            const overlay = document.createElement('div');
            overlay.className = 'satellite-overlay';

            if (scenario.type === 'æ´ªæ°´' || scenario.type === 'æš´é›¨æ´ªæ¶' || scenario.type === 'æ¢…é›¨æ´ªæ¶') {
                overlay.classList.add('flood-effect');
                map.style.backgroundColor = '#006994';
            } else if (scenario.type === 'å¹²æ—±' || scenario.type === 'å»¶è¿Ÿå¹²æ—±' || scenario.type === 'ä¼æ—±' || scenario.type === 'ä½æ¸©éœœå†»' || scenario.type === 'æå¯’' || scenario.type === 'çƒ­æµª') {
                overlay.classList.add('drought-effect');
                map.style.backgroundColor = '#8B4513';
            }

            map.appendChild(overlay);
            map.insertAdjacentHTML('beforeend',
                `<h2 style="color:white; position:absolute; top:10px; left:10px">
                    ${scenario.type}
                </h2>`);
        }

        function calculateYield(scenario) {
            let yieldRate = scenario.yieldFactor;

            if (gameState.currentCrop === 'æ°´ç¨»' && (scenario.type === 'æ´ªæ°´' || scenario.type === 'æš´é›¨æ´ªæ¶' || scenario.type === 'æ¢…é›¨æ´ªæ¶')) {
                yieldRate = 0.8;
            } else if (gameState.currentCrop === 'å°éº¦' && (scenario.type === 'å¹²æ—±' || scenario.type === 'å»¶è¿Ÿå¹²æ—±' || scenario.type === 'ä¼æ—±')) {
                yieldRate = 0.2;
            } else if (gameState.currentCrop === 'é«˜ç²±' && (scenario.type === 'å¹²æ—±' || scenario.type === 'å»¶è¿Ÿå¹²æ—±' || scenario.type === 'ä¼æ—±')) {
                yieldRate = 0.6;
            } else if (gameState.currentCrop === 'ç‰ç±³' && scenario.type === 'æ­£å¸¸') {
                yieldRate = 1.1;
            }

            if (gameState.equipment.includes('çŒæº‰è®¾å¤‡') && (scenario.type === 'å¹²æ—±' || scenario.type === 'å»¶è¿Ÿå¹²æ—±' || scenario.type === 'ä¼æ—±')) {
                yieldRate *= 1.5;
            }
            if (gameState.equipment.includes('é˜²æ´ªè®¾æ–½') && (scenario.type === 'æ´ªæ°´' || scenario.type === 'æš´é›¨æ´ªæ¶' || scenario.type === 'æ¢…é›¨æ´ªæ¶')) {
                yieldRate *= 1.3;
            }
            if (gameState.equipment.includes('æ°”è±¡ç›‘æµ‹ä»ª')) {
                const isExtreme = Math.random() < gameState.climateRisk / 100;
                if (isExtreme) {
                    const predictedScenario = gameState.location.monsoonScenarios[Math.random() > 0.5 ? 1 : 2];
                    if (predictedScenario.type === scenario.type) {
                        yieldRate *= 1.2;
                    }
                }
            }
            if (gameState.equipment.includes('é™¤è™«è®¾å¤‡') && (scenario.type === 'è—è™«ç¾å®³')) {
                yieldRate *= 1.4;
            }
            if (gameState.equipment.includes('ä¿æš–è®¾å¤‡') && (scenario.type === 'ä½æ¸©éœœå†»' || scenario.type === 'æå¯’' || scenario.type === 'å¯’æ½®')) {
                yieldRate *= 1.3;
            }

            if (gameState.labor > 0) {
                yieldRate *= 1 + gameState.labor * 0.1;
            }

            return yieldRate;
        }

        function calculateHarvest() {
            const isExtreme = Math.random() < gameState.climateRisk / 100;
            const scenario = isExtreme ?
                gameState.location.monsoonScenarios[Math.random() > 0.5 ? 1 : 2] :
                gameState.location.monsoonScenarios[0];

            updateMapEffect(scenario);
            applyRandomPolicy();

            let yieldRate = calculateYield(scenario);
            let baseIncome = 500;

            // æ”¿ç­–å½±å“
            if (gameState.policies.includes('å‡ºå£ç¦ä»¤')) baseIncome *= 0.7;
            if (gameState.policies.includes('æŠ€æœ¯æ¨å¹¿')) baseIncome *= 1.2;

            const income = Math.round(baseIncome * yieldRate * gameState.incomeMultiplier);

            gameState.laborCost = gameState.labor * gameState.location.laborCostRate;
            gameState.money = gameState.money + income - gameState.laborCost;

            recordHistory(scenario, income);

            updateClimate();
            updateDisplay();
            addLog(`æ”¶è·æ”¶å…¥: â‚¹${income}`);
            addLog(`åŠ³åŠ¨åŠ›æˆæœ¬: â‚¹${gameState.laborCost}`);

            // å¼¹çª—æ˜¾ç¤ºæ”¶è·ä¿¡æ¯
            alert(`æ”¶è·æ”¶å…¥: â‚¹${income}\nåŠ³åŠ¨åŠ›æˆæœ¬: â‚¹${gameState.laborCost}`);

            // æ£€æŸ¥æ¸¸æˆå¤±è´¥æ¡ä»¶
            if (gameState.money < 0) {
                alert('æ¸¸æˆå¤±è´¥ï¼èµ„é‡‘ä¸è¶³ã€‚');
                resetGame();
            }
            // æ£€æŸ¥æ¸¸æˆèƒœåˆ©æ¡ä»¶
            if (gameState.year >= 2033 && gameState.money >= gameState.targetMoney) {
                alert('æ¸¸æˆèƒœåˆ©ï¼ä½ æˆåŠŸåœ¨10å¹´å†…ç§¯ç´¯äº†è¶³å¤Ÿçš„èµ„é‡‘ã€‚');
                resetGame();
            }

            showKnowledgeTip();
        }

        function recordHistory(scenario, income) {
            gameState.history.push({
                year: gameState.year++,
                monsoon: scenario.type,
                income: income,
                policy: gameState.policies.slice(-1)[0] || 'æ— ',
                laborCost: gameState.laborCost
            });

            const tbody = document.getElementById('history-body');
            tbody.innerHTML = gameState.history.map(entry => `
                <tr>
                    <td>${entry.year}</td>
                    <td>${entry.monsoon}</td>
                    <td>â‚¹${entry.income}</td>
                    <td>${entry.policy}</td>
                    <td>â‚¹${entry.laborCost}</td>
                </tr>
            `).join('');
        }

        function chooseCrop(crop) {
            gameState.currentCrop = crop;
            addLog(`é€‰æ‹©ç§æ¤: ${crop}`);
        }

        function buyItem(item, cost) {
            const actualCost = Math.round(cost * gameState.equipmentCost);
            if (gameState.money >= actualCost) {
                gameState.money -= actualCost;
                gameState.equipment.push(item);
                addLog(`è´­ä¹°: ${item} (èŠ±è´¹â‚¹${actualCost})`);
                updateDisplay();
            } else {
                addLog('âš ï¸ èµ„é‡‘ä¸è¶³ï¼');
            }
        }

        function hireLabor(num) {
            const cost = num * gameState.location.laborCostRate;
            if (gameState.money >= cost) {
                gameState.money -= cost;
                gameState.labor = num;
                addLog(`é›‡ä½£ ${num} ååŠ³åŠ¨åŠ› (èŠ±è´¹â‚¹${cost})`);
                updateDisplay();
            } else {
                addLog('âš ï¸ èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•é›‡ä½£åŠ³åŠ¨åŠ›ï¼');
            }
        }

        function startNewYear() {
            if (!gameState.currentCrop) {
                alert('è¯·å…ˆé€‰æ‹©ä½œç‰©ï¼');
                return;
            }
            calculateHarvest();
        }

        function updateDisplay() {
            document.getElementById('money').textContent = gameState.money;
        }

        function addLog(message) {
            const log = document.getElementById('log');
            log.innerHTML += `<div>${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function resetGame() {
            gameState = {
                money: 1000,
                currentCrop: null,
                equipment: [],
                policies: [],
                history: [],
                climateRisk: 15,
                year: 2023,
                incomeMultiplier: 1,
                equipmentCost: 1,
                location: null,
                labor: 0,
                laborCost: 0,
                targetMoney: 5000,
                targetMoneySet: false
            };
            document.getElementById('money').textContent = gameState.money;
            document.getElementById('policy-effect').innerHTML = '';
            document.getElementById('history-body').innerHTML = '';
            document.getElementById('climate-meter').textContent = 'æç«¯å¤©æ°”æ¦‚ç‡: 15%';
            // å¯ç”¨ç›®æ ‡é‡‘é’±è®¾ç½®
            document.getElementById('target-money').disabled = false;
            document.querySelector('#target-money-setting button').disabled = false;
            initGame();
        }

        function showLocationInfo() {
            const description = gameState.location.description;
            document.getElementById('location-description').textContent = description;
        }

        function showKnowledgeTip() {
            const tips = {
                "ä¿„ç½—æ–¯": [
                    "ä¿„ç½—æ–¯çš„è¥¿ä¼¯åˆ©äºšåœ°åŒºæ˜¯ä¸–ç•Œä¸Šæœ€å†·çš„åœ°åŒºä¹‹ä¸€ï¼Œå†¬å­£æ°”æ¸©å¯ä½è‡³é›¶ä¸‹50æ‘„æ°åº¦ä»¥ä¸‹ã€‚",
                    "ä¿„ç½—æ–¯çš„æ£®æ—èµ„æºä¸°å¯Œï¼Œæ£®æ—è¦†ç›–ç‡çº¦ä¸º49%ã€‚",
                    "ä¿„ç½—æ–¯çš„å†œä¸šä¸»è¦é›†ä¸­åœ¨å—éƒ¨çš„ä¼å°”åŠ æ²³æµåŸŸå’Œé¡¿æ²³æµåŸŸã€‚"
                ],
                "ä¸œå—äºš": [
                    "ä¸œå—äºšæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å¤©ç„¶æ©¡èƒ¶ç”Ÿäº§åœ°ï¼Œæ³°å›½ã€å°åº¦å°¼è¥¿äºšå’Œé©¬æ¥è¥¿äºšæ˜¯ä¸»è¦çš„ç”Ÿäº§å›½ã€‚",
                    "ä¸œå—äºšçš„çƒ­å¸¦é›¨æ—æ˜¯è®¸å¤šçç¨€åŠ¨æ¤ç‰©çš„æ –æ¯åœ°ï¼Œå¦‚çŒ©çŒ©ã€å¤§è±¡å’ŒçŠ€ç‰›ã€‚",
                    "ä¸œå—äºšçš„å­£é£æ°”å€™åˆ†ä¸ºæ—±å­£å’Œé›¨å­£ï¼Œé›¨å­£ä¸€èˆ¬ä»5æœˆæŒç»­åˆ°10æœˆã€‚"
                ],
                "å°åº¦": [
                    "å°åº¦æ˜¯ä¸–ç•Œä¸Šç¬¬äºŒäººå£å¤§å›½ï¼Œäººå£è¶…è¿‡13äº¿ã€‚",
                    "å°åº¦çš„æ’æ²³æ˜¯å°åº¦æ•™çš„åœ£æ²³ï¼Œæ¯å¹´æœ‰å¤§é‡çš„ä¿¡å¾’å‰å¾€æ’æ²³æ²æµ´ç¥ˆç¦ã€‚",
                    "å°åº¦çš„å†œä¸šä»¥æ°´ç¨»å’Œå°éº¦ç§æ¤ä¸ºä¸»ï¼Œæ˜¯ä¸–ç•Œä¸Šé‡è¦çš„ç²®é£Ÿç”Ÿäº§å›½ä¹‹ä¸€ã€‚"
                ],
                "ä¸­å›½å—æ–¹": [
                    "ä¸­å›½å—æ–¹çš„ç æ±Ÿä¸‰è§’æ´²æ˜¯ä¸­å›½é‡è¦çš„åˆ¶é€ ä¸šåŸºåœ°ï¼Œä»¥ç”µå­ã€æœè£…å’Œç©å…·ç­‰äº§ä¸šé—»åã€‚",
                    "ä¸­å›½å—æ–¹çš„èŒ¶å¶å“ç§ç¹å¤šï¼Œå¦‚è¥¿æ¹–é¾™äº•ã€é“è§‚éŸ³å’Œæ™®æ´±èŒ¶ç­‰ã€‚",
                    "ä¸­å›½å—æ–¹çš„æ¢…é›¨å­£èŠ‚ä¸€èˆ¬ä»6æœˆæŒç»­åˆ°7æœˆï¼ŒæœŸé—´é™é›¨é¢‘ç¹ã€‚"
                ],
                "ä¸­å›½åŒ—æ–¹": [
                    "ä¸­å›½åŒ—æ–¹çš„é»„åœŸé«˜åŸæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„é»„åœŸå †ç§¯åŒºï¼Œæ°´åœŸæµå¤±ä¸¥é‡ã€‚",
                    "ä¸­å›½åŒ—æ–¹çš„ä¸œåŒ—åœ°åŒºæ˜¯ä¸­å›½é‡è¦çš„é‡å·¥ä¸šåŸºåœ°ï¼Œä»¥é’¢é“ã€æœºæ¢°å’ŒåŒ–å·¥ç­‰äº§ä¸šä¸ºä¸»ã€‚",
                    "ä¸­å›½åŒ—æ–¹çš„å†¬å­£å¯’å†·å¹²ç‡¥ï¼Œé™é›ªè¾ƒå¤šï¼Œæ˜¯ä¸­å›½é‡è¦çš„å†°é›ªæ—…æ¸¸èƒœåœ°ã€‚"
                ]
            };
            const locationTips = tips[gameState.location.name];
            const randomIndex = Math.floor(Math.random() * locationTips.length);
            const tip = locationTips[randomIndex];
            alert(`åœ°ç†å°çŸ¥è¯†ï¼š${tip}`);
        }

        // æ˜¾ç¤ºè§„åˆ™å¼¹çª—
        function showRulesModal() {
            document.getElementById('rules-modal').style.display = "block";
        }

        // å…³é—­è§„åˆ™å¼¹çª—
        function closeRulesModal() {
            document.getElementById('rules-modal').style.display = "none";
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>

</html>    