<!DOCTYPE html>
<html>

<head>
    <title>å­£é£å†³ç­–è€…</title>
    <link rel="icon" href="./f.ico">
    <style>
        :root {
            --flood-color: #006994;
            --drought-color: #8B4513;
            --primary-bg: #f0f8ff;
            --secondary-bg: #fff;
            --accent-color: #4682B4;
            --policy-bg: #fff9e6;
            --policy-border: #ffd700;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--primary-bg);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 20px;
            width: 100%;
        }

        #map {
            height: 250px;
            background: linear-gradient(160deg, #4d7c3f 0%, #87CEEB 100%);
            border-radius: 10px;
            transition: all 0.5s;
            position: relative;
            overflow: hidden;
        }

        .satellite-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: 40px 40px;
            opacity: 0.7;
        }

        .policy-card {
            background: var(--policy-bg);
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid var(--policy-border);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
        }

        .history-table th {
            background: var(--accent-color);
            color: white;
        }

        .history-table td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        @keyframes flood-pulse {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 40px 40px;
            }
        }

        @keyframes drought-pulse {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 40px -40px;
            }
        }

        .flood-effect {
            background-image: linear-gradient(45deg,
                    var(--flood-color) 25%,
                    transparent 25%,
                    transparent 50%,
                    var(--flood-color) 50%,
                    var(--flood-color) 75%,
                    transparent 75%);
            animation: flood-pulse 2s linear infinite;
        }

        .drought-effect {
            background-image: linear-gradient(45deg,
                    var(--drought-color) 25%,
                    transparent 25%,
                    transparent 50%,
                    var(--drought-color) 50%,
                    var(--drought-color) 75%,
                    transparent 75%);
            animation: drought-pulse 2s linear infinite;
        }

        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }

        button:hover {
            background: #356a93;
        }

        #log {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: var(--secondary-bg);
            border-radius: 5px;
        }

        #target-money-setting {
            margin-bottom: 20px;
        }

        #location-info {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="grid-container">
        <!-- ä¸»æ¸¸æˆåŒº -->
        <div>
            <h1>ğŸŒ¦ï¸ å­£é£å†³ç­–è€… ğŸšœ</h1>
            <div id="target-money-setting">
                <label for="target-money">è®¾ç½®ç›®æ ‡é‡‘é’±:</label>
                <input type="number" id="target-money" value="5000">
                <button onclick="setTargetMoney()">ç¡®å®š</button>
            </div>
            <div id="map"></div>

            <div id="controls">
                <h3>ğŸ’° èµ„é‡‘: â‚¹<span id="money">1000</span></h3>
                <div id="current-policy" class="policy-card"></div>

                <h3>ğŸŒ± é€‰æ‹©ä½œç‰©:</h3>
                <div id="crop-buttons"></div>

                <h3>ğŸ› ï¸ å†œä¸šè®¾å¤‡:</h3>
                <div id="equipment-buttons"></div>

                <h3>ğŸ‘·â€â™‚ï¸ é›‡ä½£åŠ³åŠ¨åŠ›:</h3>
                <div id="labor-buttons"></div>

                <button onclick="startNewYear()" style="margin:20px 0">â© è¿›å…¥ä¸‹ä¸€å¹´</button>
                <button onclick="showTips()">ğŸ’¡ æç¤º</button>
            </div>

            <div id="log"></div>
        </div>

        <!-- ä¿¡æ¯é¢æ¿ -->
        <div>
            <h3>ğŸ“œ å½“å‰æ”¿ç­–</h3>
            <div id="policy-effect"></div>

            <h3>ğŸ“Š å†å²æ•°æ®</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>å¹´ä»½</th>
                        <th>å­£é£</th>
                        <th>æ”¶å…¥</th>
                        <th>æ”¿ç­–</th>
                        <th>åŠ³åŠ¨åŠ›æˆæœ¬</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>

            <h3>ğŸŒ æ°”å€™å˜åŒ–æŒ‡æ•°</h3>
            <div id="climate-meter">æç«¯å¤©æ°”æ¦‚ç‡: 15%</div>

            <h3>ğŸ“š å¸®åŠ©ä¿¡æ¯</h3>
            <div id="help-info">
                <p>ğŸŒ± é€‰æ‹©åˆé€‚çš„ä½œç‰©ï¼Œä¸åŒä½œç‰©å¯¹å­£é£çš„é€‚åº”èƒ½åŠ›ä¸åŒã€‚</p>
                <p>ğŸ› ï¸ è´­ä¹°å†œä¸šè®¾å¤‡å¯ä»¥æé«˜ä½œç‰©äº§é‡ã€‚</p>
                <p>ğŸ‘·â€â™‚ï¸ é›‡ä½£åŠ³åŠ¨åŠ›èƒ½æé«˜å·¥ä½œæ•ˆç‡ï¼Œä½†ä¼šå¢åŠ æˆæœ¬ã€‚</p>
                <p>ğŸ“œ æ”¿ç­–ä¼šå½±å“ä½ çš„æ”¶å…¥å’Œæˆæœ¬ï¼Œæ³¨æ„åº”å¯¹ã€‚</p>
                <p>ğŸŒ æ°”å€™å˜åŒ–æŒ‡æ•°ä¼šå½±å“æç«¯å¤©æ°”çš„æ¦‚ç‡ï¼Œæ³¨æ„åº”å¯¹ã€‚</p>
            </div>
        </div>
    </div>
    <div id="location-info">
        <h3>å½“å‰å‡ºç”Ÿåœ°ä¿¡æ¯</h3>
        <p id="location-description"></p>
    </div>

    <!-- è§„åˆ™å¼¹çª— -->
    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRulesModal()">&times;</span>
            <h2>æ¸¸æˆè§„åˆ™å’Œæœºåˆ¶ç®€ä»‹</h2>
            <p>ä½ å°†æ‰®æ¼”ä¸€ä½å†œä¸šå†³ç­–è€…ï¼Œåœ¨ä¸åŒçš„åœ°åŒºç»è¥å†œåœºã€‚æ¸¸æˆç›®æ ‡æ˜¯åœ¨10å¹´å†…ç§¯ç´¯è¶³å¤Ÿçš„èµ„é‡‘è¾¾åˆ°è®¾å®šçš„ç›®æ ‡é‡‘é’±ã€‚</p>
            <p>1. é€‰æ‹©å‡ºç”Ÿåœ°ï¼šæ¸¸æˆå¼€å§‹æ—¶ï¼Œä½ å°†éšæœºå‡ºç”Ÿåœ¨ä¸€ä¸ªåœ°åŒºï¼Œæ¯ä¸ªåœ°åŒºæœ‰ä¸åŒçš„æ°”å€™é£é™©ã€é€‚åˆç§æ¤çš„ä½œç‰©å’Œæ”¿ç­–ã€‚</p>
            <p>2. è®¾ç½®ç›®æ ‡é‡‘é’±ï¼šåœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼Œä½ å¯ä»¥è®¾ç½®ç›®æ ‡é‡‘é’±ï¼Œè®¾ç½®åæ— æ³•é‡æ–°è®¾ç½®ã€‚</p>
            <p>3. é€‰æ‹©ä½œç‰©ï¼šæ ¹æ®æ‰€åœ¨åœ°åŒºï¼Œé€‰æ‹©é€‚åˆç§æ¤çš„ä½œç‰©ã€‚ä¸åŒä½œç‰©å¯¹å­£é£çš„é€‚åº”èƒ½åŠ›ä¸åŒã€‚</p>
            <p>4. è´­ä¹°è®¾å¤‡ï¼šè´­ä¹°å†œä¸šè®¾å¤‡å¯ä»¥æé«˜ä½œç‰©äº§é‡ï¼Œåº”å¯¹ä¸åŒçš„æ°”å€™ç¾å®³ã€‚</p>
            <p>5. é›‡ä½£åŠ³åŠ¨åŠ›ï¼šé›‡ä½£åŠ³åŠ¨åŠ›èƒ½æé«˜å·¥ä½œæ•ˆç‡ï¼Œä½†ä¼šå¢åŠ æˆæœ¬ã€‚</p>
            <p>6. åº”å¯¹æ”¿ç­–ï¼šæ”¿åºœä¼šéšæœºé¢å¸ƒæ”¿ç­–ï¼Œå½±å“ä½ çš„æ”¶å…¥å’Œæˆæœ¬ã€‚</p>
            <p>7. åº”å¯¹æ°”å€™å˜åŒ–ï¼šéšç€æ¸¸æˆè¿›è¡Œï¼Œæ°”å€™å˜åŒ–æŒ‡æ•°ä¼šä¸Šå‡ï¼Œæç«¯å¤©æ°”çš„æ¦‚ç‡å¢åŠ ã€‚</p>
            <p>8. æ”¶è·æ”¶å…¥ï¼šæ¯å¹´æ”¶è·æ—¶ï¼Œæ ¹æ®ä½œç‰©äº§é‡ã€æ”¿ç­–å’Œæ°”å€™å˜åŒ–ç­‰å› ç´ è®¡ç®—æ”¶å…¥ã€‚</p>
            <p>9. æ¸¸æˆèƒœåˆ©å’Œå¤±è´¥ï¼šå¦‚æœåœ¨10å¹´å†…ç§¯ç´¯çš„èµ„é‡‘è¾¾åˆ°æˆ–è¶…è¿‡ç›®æ ‡é‡‘é’±ï¼Œæ¸¸æˆèƒœåˆ©ï¼›å¦‚æœèµ„é‡‘ä¸è¶³ï¼Œæ¸¸æˆå¤±è´¥ã€‚</p>
            <p>ï¼ˆåˆä¸€å››ç­ ç‹å­é¾™ååŠ©åˆ¶ä½œï¼‰</p>
        </div>
    </div>

    <!-- æç¤ºå¼¹çª— -->
    <div id="tips-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTipsModal()">&times;</span>
            <h2>æ¸¸æˆæç¤º</h2>
            <p>é€‰æ‹©é€‚åˆå½“åœ°æ°”å€™çš„ä½œç‰©å¯ä»¥æé«˜äº§é‡ã€‚</p>
            <p>è´­ä¹°åˆé€‚çš„è®¾å¤‡èƒ½åº”å¯¹ä¸åŒçš„ç¾å®³ã€‚</p>
            <p>åˆç†é›‡ä½£åŠ³åŠ¨åŠ›èƒ½æé«˜æ•ˆç‡ï¼Œä½†è¦æ§åˆ¶æˆæœ¬ã€‚</p>
            <p>å…³æ³¨æ”¿ç­–å˜åŒ–ï¼Œåˆ©ç”¨æ”¿ç­–ä¼˜åŠ¿å¢åŠ æ”¶å…¥ã€‚</p>
            <p>éšç€å¹´ä»½å¢åŠ ï¼Œæç«¯å¤©æ°”æ¦‚ç‡ä¸Šå‡ï¼Œæå‰åšå¥½å‡†å¤‡ã€‚</p>
        </div>
    </div>

    <script>
        let gameState = {
            money: 1000,
            currentCrop: null,
            equipment: [],
            policies: [],
            history: [],
            climateRisk: 70,
            year: 2023,
            incomeMultiplier: 1,
            equipmentCost: 1,
            location: null,
            labor: 0,
            laborCost: 0,
            targetMoney: 5000,
            targetMoneySet: false,
            disasterCount: 0 // æ–°å¢å±æ€§ï¼Œè®°å½•ç¾å®³æ¬¡æ•°
        };

        const LOCATIONS = [
            {
                name: "ä¿„ç½—æ–¯",
                climateRisk: 10,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 0.8 },
                    { type: "ä½æ¸©éœœå†»", yieldFactor: 0.2 },
                    { type: "æš´é›¨æ´ªæ¶", yieldFactor: 0.4 },
                    { type: "æš´é›ª", yieldFactor: 0.1 },
                    { type: "æå¯’", yieldFactor: 0.15 }
                ],
                suitableCrops: ["å°éº¦", "å¤§éº¦", "äºšéº»"],
                policies: [
                    {
                        name: "å†œä¸šè¡¥è´´",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸ’¸ æ”¿åºœæä¾›å†œä¸šè¡¥è´´ï¼Œæ”¶å…¥å¢åŠ 10%"
                    },
                    {
                        name: "æŠ€æœ¯æ”¯æŒ",
                        effect: () => gameState.equipmentCost = 0.9,
                        description: "ğŸ’¡ æ”¿åºœæä¾›æŠ€æœ¯æ”¯æŒï¼Œè®¾å¤‡ä»·æ ¼é™ä½10%"
                    },
                    {
                        name: "åœŸåœ°ä¼˜æƒ ",
                        effect: () => gameState.money += 200,
                        description: "ğŸ’¸ æ”¿åºœç»™äºˆåœŸåœ°ä½¿ç”¨ä¼˜æƒ ï¼Œèµ„é‡‘å¢åŠ â‚¹200"
                    }
                ],
                laborCostRate: 20,
                description: "ä¿„ç½—æ–¯åœ°åŸŸå¹¿é˜”ï¼Œå†¬å­£å¯’å†·æ¼«é•¿ï¼Œå¤å­£æ¸©æš–çŸ­ä¿ƒã€‚å†œä¸šä¸»è¦é›†ä¸­åœ¨å—éƒ¨åœ°åŒºï¼Œä½æ¸©éœœå†»å’Œæš´é›ªç­‰ç¾å®³è¾ƒä¸ºå¸¸è§ã€‚ç”±äºåœ°å¹¿äººç¨€ï¼ŒåŠ³åŠ¨åŠ›æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚é€‚åˆç§æ¤è€å¯’çš„ä½œç‰©ï¼Œå¦‚å°éº¦ã€å¤§éº¦å’Œäºšéº»ã€‚"
            },
            {
                name: "ä¸œå—äºš",
                climateRisk: 20,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 1.2 },
                    { type: "å°é£", yieldFactor: 0.3 },
                    { type: "æ´ªæ°´", yieldFactor: 0.5 },
                    { type: "æ³¥çŸ³æµ", yieldFactor: 0.2 },
                    { type: "æ£®æ—ç«ç¾", yieldFactor: 0.35 }
                ],
                suitableCrops: ["æ°´ç¨»", "æ©¡èƒ¶", "æ£•æ¦ˆæ²¹"],
                policies: [
                    {
                        name: "å‡ºå£é¼“åŠ±",
                        effect: () => gameState.incomeMultiplier *= 1.3,
                        description: "ğŸŒ æ”¿åºœé¼“åŠ±å‡ºå£ï¼Œæ”¶å…¥å¢åŠ 30%"
                    },
                    {
                        name: "ç¾å®³æ•‘æ´",
                        effect: () => gameState.money += 300,
                        description: "ğŸ’¸ æ”¿åºœæä¾›ç¾å®³æ•‘æ´èµ„é‡‘â‚¹300"
                    },
                    {
                        name: "å†œä¸šåŸ¹è®­",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸ’¡ æ”¿åºœå¼€å±•å†œä¸šåŸ¹è®­ï¼Œæ”¶å…¥å¢åŠ 10%"
                    }
                ],
                laborCostRate: 10,
                description: "ä¸œå—äºšåœ°å¤„çƒ­å¸¦ï¼Œæ°”å€™ç‚çƒ­å¤šé›¨ï¼Œæ˜¯ä¸–ç•Œä¸Šé‡è¦çš„æ°´ç¨»ã€æ©¡èƒ¶å’Œæ£•æ¦ˆæ²¹äº§åŒºã€‚å°é£ã€æ´ªæ°´å’Œæ³¥çŸ³æµç­‰ç¾å®³é¢‘ç¹ã€‚åŠ³åŠ¨åŠ›èµ„æºä¸°å¯Œï¼Œæˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚"
            },
            {
                name: "å°åº¦",
                climateRisk: 25,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 1 },
                    { type: "å¹²æ—±", yieldFactor: 0.3 },
                    { type: "æ´ªæ°´", yieldFactor: 0.5 },
                    { type: "çƒ­æµª", yieldFactor: 0.25 },
                    { type: "è—è™«ç¾å®³", yieldFactor: 0.1 }
                ],
                suitableCrops: ["æ°´ç¨»", "å°éº¦", "æ£‰èŠ±", "ç”˜è”—"],
                policies: [
                    {
                        name: "å†œä¸šä¿é™©è¡¥è´´",
                        effect: () => gameState.incomeMultiplier *= 1.15,
                        description: "ğŸ’¸ æ”¿åºœè¡¥è´´å†œä¸šä¿é™©ï¼Œæ”¶å…¥å¢åŠ 15%"
                    },
                    {
                        name: "æ°´åˆ©å»ºè®¾",
                        effect: () => gameState.equipmentCost = 0.85,
                        description: "ğŸ’¡ æ”¿åºœè¿›è¡Œæ°´åˆ©å»ºè®¾ï¼Œè®¾å¤‡ä»·æ ¼é™ä½15%"
                    },
                    {
                        name: "ç²®é£Ÿæ”¶è´­",
                        effect: () => gameState.incomeMultiplier *= 1.2,
                        description: "ğŸŒ¾ æ”¿åºœé«˜ä»·æ”¶è´­ç²®é£Ÿï¼Œæ”¶å…¥å¢åŠ 20%"
                    }
                ],
                laborCostRate: 5,
                description: "å°åº¦äººå£ä¼—å¤šï¼ŒåŠ³åŠ¨åŠ›ä½å»‰ã€‚å±äºçƒ­å¸¦å­£é£æ°”å€™ï¼Œæ—±å­£å’Œé›¨å­£åˆ†æ˜ï¼Œå¹²æ—±ã€æ´ªæ°´å’Œçƒ­æµªç­‰ç¾å®³æ—¶æœ‰å‘ç”Ÿã€‚æ˜¯é‡è¦çš„å†œä¸šå›½å®¶ï¼Œä¸»è¦ç§æ¤æ°´ç¨»ã€å°éº¦ã€æ£‰èŠ±å’Œç”˜è”—ç­‰ä½œç‰©ã€‚"
            },
            {
                name: "ä¸­å›½å—æ–¹",
                climateRisk: 22,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 1.1 },
                    { type: "æ¢…é›¨æ´ªæ¶", yieldFactor: 0.4 },
                    { type: "ä¼æ—±", yieldFactor: 0.3 },
                    { type: "å°é£", yieldFactor: 0.35 },
                    { type: "å±±ä½“æ»‘å¡", yieldFactor: 0.2 }
                ],
                suitableCrops: ["æ°´ç¨»", "èŒ¶å¶", "æŸ‘æ©˜"],
                policies: [
                    {
                        name: "å†œä¸šç§‘æŠ€åˆ›æ–°",
                        effect: () => gameState.incomeMultiplier *= 1.2,
                        description: "ğŸ’¡ æ”¿åºœæ¨åŠ¨å†œä¸šç§‘æŠ€åˆ›æ–°ï¼Œæ”¶å…¥å¢åŠ 20%"
                    },
                    {
                        name: "æŠ—æ—±æ•‘ç¾",
                        effect: () => gameState.money += 250,
                        description: "ğŸ’¸ æ”¿åºœæä¾›æŠ—æ—±æ•‘ç¾èµ„é‡‘â‚¹250"
                    },
                    {
                        name: "ç”Ÿæ€å†œä¸šè¡¥è´´",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸŒ³ æ”¿åºœè¡¥è´´ç”Ÿæ€å†œä¸šï¼Œæ”¶å…¥å¢åŠ 10%"
                    }
                ],
                laborCostRate: 15,
                description: "ä¸­å›½å—æ–¹æ°”å€™æ¸©æš–æ¹¿æ¶¦ï¼Œé›¨é‡å……æ²›ï¼Œæ˜¯é‡è¦çš„æ°´ç¨»ã€èŒ¶å¶å’ŒæŸ‘æ©˜äº§åŒºã€‚æ¢…é›¨æ´ªæ¶ã€ä¼æ—±å’Œå°é£ç­‰ç¾å®³è¾ƒä¸ºå¸¸è§ã€‚å†œä¸šç§‘æŠ€æ°´å¹³è¾ƒé«˜ï¼Œæ”¿åºœæ³¨é‡ç”Ÿæ€å†œä¸šå‘å±•ã€‚"
            },
            {
                name: "ä¸­å›½åŒ—æ–¹",
                climateRisk: 18,
                monsoonScenarios: [
                    { type: "æ­£å¸¸", yieldFactor: 0.9 },
                    { type: "å¹²æ—±", yieldFactor: 0.2 },
                    { type: "æš´é›¨", yieldFactor: 0.5 },
                    { type: "æ²™å°˜æš´", yieldFactor: 0.15 },
                    { type: "å¯’æ½®", yieldFactor: 0.2 }
                ],
                suitableCrops: ["å°éº¦", "ç‰ç±³", "å¤§è±†"],
                policies: [
                    {
                        name: "èŠ‚æ°´çŒæº‰æ¨å¹¿",
                        effect: () => gameState.equipmentCost = 0.9,
                        description: "ğŸ’¡ æ”¿åºœæ¨å¹¿èŠ‚æ°´çŒæº‰ï¼Œè®¾å¤‡ä»·æ ¼é™ä½10%"
                    },
                    {
                        name: "åœŸå£¤æ”¹è‰¯",
                        effect: () => gameState.incomeMultiplier *= 1.1,
                        description: "ğŸ’ª æ”¿åºœè¿›è¡ŒåœŸå£¤æ”¹è‰¯ï¼Œæ”¶å…¥å¢åŠ 10%"
                    },
                    {
                        name: "ç¾å®³é¢„è­¦",
                        effect: () => gameState.climateRisk *= 0.8,
                        description: "ğŸ“¢ æ”¿åºœå‘å¸ƒç¾å®³é¢„è­¦ï¼Œæç«¯å¤©æ°”æ¦‚ç‡é™ä½20%"
                    }
                ],
                laborCostRate: 12,
                description: "ä¸­å›½åŒ—æ–¹å±äºæ¸©å¸¦å­£é£æ°”å€™ï¼Œé™æ°´é›†ä¸­åœ¨å¤å­£ï¼Œå¹²æ—±ã€æš´é›¨å’Œæ²™å°˜æš´ç­‰ç¾å®³æ—¶æœ‰å‘ç”Ÿã€‚é€‚åˆç§æ¤å°éº¦ã€ç‰ç±³å’Œå¤§è±†ç­‰ä½œç‰©ã€‚"
            }
        ];

        function initGame() {
            const randomIndex = Math.floor(Math.random() * LOCATIONS.length);
            gameState.location = LOCATIONS[randomIndex];
            document.getElementById('location-description').textContent = gameState.location.description;
            updateDisplay();
            showRulesModal();
        }

        function setTargetMoney() {
            if (!gameState.targetMoneySet) {
                const target = parseInt(document.getElementById('target-money').value);
                if (!isNaN(target) && target > 0) {
                    gameState.targetMoney = target;
                    gameState.targetMoneySet = true;
                    addLog(`ç›®æ ‡é‡‘é’±å·²è®¾ç½®ä¸º â‚¹${target}`);
                } else {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡é‡‘é’±æ•°é¢ï¼');
                }
            } else {
                alert('ç›®æ ‡é‡‘é’±å·²è®¾ç½®ï¼Œæ— æ³•å†æ¬¡ä¿®æ”¹ã€‚');
            }
        }

        function updateClimate() {
            document.getElementById('climate-meter').textContent = `æç«¯å¤©æ°”æ¦‚ç‡: ${gameState.climateRisk}%`;
        }

        function applyRandomPolicy() {
            const policies = gameState.location.policies;
            const randomPolicy = policies[Math.floor(Math.random() * policies.length)];
            gameState.policies.push(randomPolicy.name);
            randomPolicy.effect();
            const policyDiv = document.getElementById('current-policy');
            policyDiv.textContent = randomPolicy.description;
            addLog(randomPolicy.description);
        }

        function updateMapEffect(scenario) {
            const map = document.getElementById('map');
            const overlay = document.createElement('div');
            overlay.classList.add('satellite-overlay');
            if (scenario.type.includes('æ´ªæ°´') || scenario.type.includes('æ´ªæ¶')) {
                overlay.classList.add('flood-effect');
            } else if (scenario.type.includes('å¹²æ—±') || scenario.type.includes('ä¼æ—±')) {
                overlay.classList.add('drought-effect');
            }
            map.innerHTML = '';
            map.appendChild(overlay);
        }

        function calculateYield(scenario) {
            let yieldRate = scenario.yieldFactor;
            if (gameState.equipment.includes('çŒæº‰è®¾å¤‡') && scenario.type.includes('å¹²æ—±')) {
                yieldRate *= 1.5;
            }
            if (gameState.equipment.includes('é˜²æ´ªè®¾å¤‡') && scenario.type.includes('æ´ªæ°´')) {
                yieldRate *= 1.5;
            }
            return yieldRate;
        }

        function calculateHarvest() {
            const isExtreme = Math.random() < gameState.climateRisk / 100;
            const scenario = isExtreme ?
                gameState.location.monsoonScenarios[Math.floor(Math.random() * (gameState.location.monsoonScenarios.length - 1)) + 1] :
                gameState.location.monsoonScenarios[0];

            if (isExtreme) {
                gameState.disasterCount++;
                if (Math.random() < 0.6) {
                    const randomIndex = Math.floor(Math.random() * gameState.equipment.length);
                    if (gameState.equipment.length > 0) {
                        const damagedEquipment = gameState.equipment.splice(randomIndex, 1)[0];
                        addLog(`âš ï¸ ç¾å®³å¯¼è‡´ ${damagedEquipment} æŸåï¼`);
                    }
                }
                if (Math.random() < 0.4) {
                    const lostLabor = Math.min(gameState.labor, Math.floor(Math.random() * 3) + 1);
                    gameState.labor -= lostLabor;
                    addLog(`âš ï¸ ç¾å®³å¯¼è‡´ ${lostLabor} ååŠ³åŠ¨åŠ›æµå¤±ï¼`);
                }
                // ç¾å®³å‘ç”Ÿæ—¶å¼¹çª—æç¤º
                alert(`âš ï¸ ${gameState.year} å¹´å‘ç”Ÿäº† ${scenario.type} ç¾å®³ï¼`);
            }

            updateMapEffect(scenario);
            applyRandomPolicy();

            let yieldRate = calculateYield(scenario);
            let baseIncome = 500;

            if (gameState.policies.includes('å‡ºå£ç¦ä»¤')) baseIncome *= 0.7;
            if (gameState.policies.includes('æŠ€æœ¯æ¨å¹¿')) baseIncome *= 1.2;

            const income = Math.round(baseIncome * yieldRate * gameState.incomeMultiplier);

            gameState.laborCost = gameState.labor * gameState.location.laborCostRate;
            gameState.money = gameState.money + income - gameState.laborCost;

            recordHistory(scenario, income);

            updateClimate();
            updateDisplay();
            addLog(`æ”¶è·æ”¶å…¥: â‚¹${income}`);
            addLog(`åŠ³åŠ¨åŠ›æˆæœ¬: â‚¹${gameState.laborCost}`);

            alert(`æ”¶è·æ”¶å…¥: â‚¹${income}\nåŠ³åŠ¨åŠ›æˆæœ¬: â‚¹${gameState.laborCost}`);

            if (gameState.money < 0) {
                alert('æ¸¸æˆå¤±è´¥ï¼èµ„é‡‘ä¸è¶³ã€‚');
                resetGame();
            }
            if (gameState.year >= 2033 && gameState.money >= gameState.targetMoney) {
                alert('æ¸¸æˆèƒœåˆ©ï¼ä½ æˆåŠŸåœ¨10å¹´å†…ç§¯ç´¯äº†è¶³å¤Ÿçš„èµ„é‡‘ã€‚');
                resetGame();
            }

            showKnowledgeTip();
        }

        function recordHistory(scenario, income) {
            const historyRow = document.createElement('tr');
            historyRow.innerHTML = `
                <td>${gameState.year}</td>
                <td>${scenario.type}</td>
                <td>â‚¹${income}</td>
                <td>${gameState.policies.join(', ')}</td>
                <td>â‚¹${gameState.laborCost}</td>
            `;
            document.getElementById('history-body').appendChild(historyRow);
            gameState.history.push({
                year: gameState.year,
                scenario: scenario.type,
                income: income,
                policies: gameState.policies.slice(),
                laborCost: gameState.laborCost
            });
            gameState.policies = [];
        }

        function chooseCrop(crop) {
            gameState.currentCrop = crop;
            addLog(`ä½ é€‰æ‹©äº†ç§æ¤ ${crop}ã€‚`);
        }

        function buyItem(item, cost) {
            const totalCost = cost * gameState.equipmentCost;
            if (gameState.money >= totalCost) {
                gameState.money -= totalCost;
                gameState.equipment.push(item);
                addLog(`ä½ è´­ä¹°äº† ${item}ï¼ŒèŠ±è´¹ â‚¹${totalCost}ã€‚`);
                updateDisplay();
            } else {
                alert('èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•è´­ä¹°ï¼');
            }
        }

        function hireLabor(num) {
            const totalCost = num * gameState.location.laborCostRate;
            if (gameState.money >= totalCost) {
                gameState.money -= totalCost;
                gameState.labor += num;
                addLog(`ä½ é›‡ä½£äº† ${num} ååŠ³åŠ¨åŠ›ï¼ŒèŠ±è´¹ â‚¹${totalCost}ã€‚`);
                updateDisplay();
            } else {
                alert('èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•é›‡ä½£åŠ³åŠ¨åŠ›ï¼');
            }
        }

        function startNewYear() {
            if (!gameState.targetMoneySet) {
                alert('è¯·å…ˆè®¾ç½®ç›®æ ‡é‡‘é’±ï¼');
                return;
            }
            if (!gameState.currentCrop) {
                alert('è¯·å…ˆé€‰æ‹©ä½œç‰©ï¼');
                return;
            }
            gameState.year++;
            calculateHarvest();
        }

        function updateDisplay() {
            document.getElementById('money').textContent = gameState.money;
            const cropButtons = document.getElementById('crop-buttons');
            cropButtons.innerHTML = '';
            gameState.location.suitableCrops.forEach(crop => {
                const button = document.createElement('button');
                button.textContent = crop;
                button.onclick = () => chooseCrop(crop);
                cropButtons.appendChild(button);
            });

            const equipmentButtons = document.getElementById('equipment-buttons');
            equipmentButtons.innerHTML = '';
            const equipmentList = [
                { name: "çŒæº‰è®¾å¤‡", cost: 200 },
                { name: "é˜²æ´ªè®¾å¤‡", cost: 300 },
                { name: "æ”¶å‰²è®¾å¤‡", cost: 250 }
            ];
            equipmentList.forEach(item => {
                const button = document.createElement('button');
                button.textContent = `${item.name} (â‚¹${item.cost * gameState.equipmentCost})`;
                button.onclick = () => buyItem(item.name, item.cost);
                equipmentButtons.appendChild(button);
            });

            const laborButtons = document.getElementById('labor-buttons');
            laborButtons.innerHTML = '';
            [1, 2, 3].forEach(num => {
                const button = document.createElement('button');
                button.textContent = `é›‡ä½£ ${num} ååŠ³åŠ¨åŠ› (â‚¹${num * gameState.location.laborCostRate})`;
                button.onclick = () => hireLabor(num);
                laborButtons.appendChild(button);
            });
        }

        function addLog(message) {
            const log = document.getElementById('log');
            const p = document.createElement('p');
            p.textContent = message;
            log.appendChild(p);
            log.scrollTop = log.scrollHeight;
        }

        function resetGame() {
            gameState = {
                money: 1000,
                currentCrop: null,
                equipment: [],
                policies: [],
                history: [],
                climateRisk: 15,
                year: 2023,
                incomeMultiplier: 1,
                equipmentCost: 1,
                location: null,
                labor: 0,
                laborCost: 0,
                targetMoney: 5000,
                targetMoneySet: false,
                disasterCount: 0
            };
            document.getElementById('history-body').innerHTML = '';
            document.getElementById('log').innerHTML = '';
            document.getElementById('current-policy').textContent = '';
            document.getElementById('map').innerHTML = '';
            initGame();
        }

        function showLocationInfo() {
            alert(gameState.location.description);
        }

        function showKnowledgeTip() {
            const tips = [
                "é€‰æ‹©é€‚åˆå½“åœ°æ°”å€™çš„ä½œç‰©å¯ä»¥æé«˜äº§é‡ã€‚",
                "è´­ä¹°åˆé€‚çš„è®¾å¤‡èƒ½åº”å¯¹ä¸åŒçš„ç¾å®³ã€‚",
                "åˆç†é›‡ä½£åŠ³åŠ¨åŠ›èƒ½æé«˜æ•ˆç‡ï¼Œä½†è¦æ§åˆ¶æˆæœ¬ã€‚",
                "å…³æ³¨æ”¿ç­–å˜åŒ–ï¼Œåˆ©ç”¨æ”¿ç­–ä¼˜åŠ¿å¢åŠ æ”¶å…¥ã€‚",
                "éšç€å¹´ä»½å¢åŠ ï¼Œæç«¯å¤©æ°”æ¦‚ç‡ä¸Šå‡ï¼Œæå‰åšå¥½å‡†å¤‡ã€‚"
            ];
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            alert(`çŸ¥è¯†å°è´´å£«: ${randomTip}`);
        }

        function showRulesModal() {
            const modal = document.getElementById('rules-modal');
            modal.style.display = 'block';
        }

        function closeRulesModal() {
            const modal = document.getElementById('rules-modal');
            modal.style.display = 'none';
        }

        function showTipsModal() {
            const modal = document.getElementById('tips-modal');
            modal.style.display = 'block';
        }

        function closeTipsModal() {
            const modal = document.getElementById('tips-modal');
            modal.style.display = 'none';
        }

        function showTips() {
            showTipsModal();
        }

        window.onload = initGame;
    </script>
</body>

</html>    
